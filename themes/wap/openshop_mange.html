<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1.0,user-scalable=no">
    <meta name="site" content="<!--@php echo $shoperWebUrl; @-->" />
    <meta name="title" content="我的店铺：<!--@php echo $shopInfo['shopname']; @-->" />
    <meta name="description" content="我的店铺：<!--@php echo $shopInfo['shopname']; @--> 客官快进来逛逛，好货多多，有惊奇呦！" />
    <title> <!--@php echo $shopInfo['shopname']; @-->—店铺管理</title>
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="__RESOURCE__/openshop/css/bootstrap.min.css">
    <link rel="stylesheet" href="__RESOURCE__/recouse/share/css/share.min.css">
    <link rel="stylesheet" href="__RESOURCE__/openshop/css/openshop.css">
</head>
<body>
<div class="shopmange_top">
    <div class="catelist noborder">
        <div class="pull-left" style="width: 15%;">
            <a href="javascript:;" onclick="window.history.back(-1)" class="return t-center"><span class="glyphicon glyphicon-chevron-left"></span></a>
        </div>
        <div class="pull-left" style="width: 70%">
            <div class="row">
                <form action="<!--@php echo mobile_url('openshop_mange',array('op'=>'list')); @-->" method="post" name="form">
                    <div class="input-group">
                        <input type="text" class="form-control add_good_search" placeholder="请输入商品名" name="keyword" value="<!--@php echo $keyword; @-->">
                        <span class="input-group-btn">
                             <button class="btn btn-default" type="submit" id="search">搜索</button>
                        </span>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="row clean mt_15" style="padding: 0px 15px;">
        <div class="logo pull-left">
            <!--@php if(empty($shopInfo['logo'])){ @-->
            <img src="__RESOURCE__/openshop/images/face.png" alt="">
            <!--@php }else{ @-->
            <img src="<!--@php echo $shopInfo['logo']; @-->" alt="">
            <!--@php } @-->
        </div>
        <div class="desc pull-left">
            <p> <!--@php echo $shopInfo['shopname']; @--></p>
            <p> <!--@php echo $shopInfo['area']; @--></p>
        </div>
    </div>
</div>

 <div class="shopmange_act">
     <div><a href="<!--@php echo mobile_url('openshop_set',array('op'=>'show','mark'=>'show'));@-->"><img src="__RESOURCE__/openshop/images/shezhi.png" alt=""><span>店铺设置</span></a></div>
     <div><a href="javascript:;"><img src="__RESOURCE__/openshop/images/zhuangxiu.png" alt=""><span>店铺装饰</span></a></div>
     <div><a href="javascript:;" class="erweima"><img src="__RESOURCE__/openshop/images/erweima.png" alt=""><span></span>店铺二维码</a></div>
     <div><a href="javascript:;" class="share"><img src="__RESOURCE__/openshop/images/zhuanfa.png" alt=""><span>分享店铺</span></a></div>
 </div>

<div style="height: 15px;background: #EEEEEE"></div>

<div class="shopmange_list">
    <div class="sele_ct">
        <div class="dropdown pull-left order11" style="margin-left:30px;">
            <button type="button" class="btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown" data-issale="1">销售中
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                <li role="presentation">
                    <a role="menuitem" tabindex="-1" href="#" data-isSale="0">未上架</a>
                </li>
            </ul>
        </div>

        <div class="dropdown pull-left order22" style="margin-left: 30px;">
            <button type="button" class="btn dropdown-toggle" id="dropdownMenu2" data-toggle="dropdown" data-order="createtime">最新排序
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu2">
                <li role="presentation">
                    <a role="menuitem" tabindex="-1" href="#" data-order="sales">销量排序</a>
                </li>
                <li role="presentation">
                    <a role="menuitem" tabindex="-1" href="#" data-order="commision">佣金排序</a>
                </li>
                <li role="presentation">
                    <a role="menuitem" tabindex="-1" href="#" data-order="marketprice">售价排序</a>
                </li>
                <li role="presentation">
                    <a role="menuitem" tabindex="-1" href="#" data-order="collect_num">收藏排序</a>
                </li>
            </ul>
        </div>
    </div>

    <div class="foot_tag">
        <a href="<!--@php echo mobile_url('openshop_goodmange');@-->"><img src="__RESOURCE__/openshop/images/gouwuche_ico.png" style="vertical-align: middle">商品管理</a>
    </div>

    <div class="content">
        <!--@php if($total == 0){ @-->
        <p class="no_data"><img src="__RESOURCE__/openshop/images/no_data.png" alt="">对不起，目前没有要卖的商品！</p>
        <!--@php }else{  @-->

        <!--@php foreach($list as $item){  @-->
        <div style="clear: both;overflow: hidden;margin-bottom:12px;" class="one_good" data-id="<!--@php echo $item['id'];@-->" data-istop="<!--@php echo $item['is_top'];@-->" id="show_list_<!--@php echo $item['id'];@-->">
            <div class="pic">
                <img src="<!--@php  echo $item['thumb']; @-->" class="img-responsive">
            </div>
            <div class="desc">
                <p class="titile" style="font-size: 12px;color: #646464;"><!--@php echo msubstr($item['title'],0,30);@--></p>
                <p class="price"><strong style="color: #35393B">￥<!--@php echo $item['marketprice'];@--></strong> &nbsp;&nbsp;<span class="yongjin">佣金: </span><span class="yongjin_m"><!--@php echo $item['commision'];@--></span></p>
                <p class="kucun" style="color: #8C8C8C;font-size: 10px;">剩余<!--@php echo $item['total'];@-->件</p>
                <p class="sale" style="color: #8C8C8C;font-size: 10px;">销量: <!--@php echo $item['sales'];@--> &nbsp;&nbsp;收藏: <!--@php echo $item['collect_num'];@--></p>
            </div>
        </div>
       <!--@php }} @-->
        <!--@php echo $pager; @-->
    </div>
</div>

<!-- 模态框（Modal）分享页面 -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    分享店铺
                </h4>
            </div>
            <div class="modal-body">
                <div class="sharejs">
                    <div id="shareBox" class=""></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>

<!-- 模态框（Modal） 二维码页面-->
<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-top: 30%">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabe2l">
                    分享我的店铺二维码
                </h4>
            </div>
            <div class="modal-body" style="text-align: center;">

            </div>
            <div class="modal-footer" style="">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>


<script type="text/javascript" src="__RESOURCE__/recouse/js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="__RESOURCE__/recouse/bootstrap3/js/bootstrap.min.js"></script>
<script src="__RESOURCE__/recouse/share/js/jquery.share.min.js"></script>
<script>
    $(function(){
        //分享插件的调用
        var shareUrl = $("meta[name='site']").attr("content");
        var imageUrl = $(".logo img").attr('src');
        $('#shareBox').share({
            sites: ['weibo','wechat','qq','qzone','tencent'],
            url:shareUrl,
            image:imageUrl
        });
    })

    $(".share").click(function(){
        //调用分享
        $('#myModal').modal('show')
    })

    $(document).delegate(".sharejs .icon-wechat",'click',function(){
//      alert('sss');
    })

    $(".erweima").click(function(){
        var erweimaUrl = $('#shareBox .qrcode img').attr('src');
        var imgtag = "<img src='"+erweimaUrl+"' style='margin:0 auto;'/>";
        $("#myModal2").modal('show');
        $("#myModal2 .modal-title").html('分享我的店铺二维码');
        $("#myModal2 .modal-body").html(imgtag);
    })


    var accesskey = "<!--@php $accesskey = getOpenshopAccessKey($member['openid']);echo $accesskey;@-->";
    var xiajiaurl = "<!--@php echo mobile_url('openshop_action',array('act'=>'xiajia'));@-->";
    var deleteurl = "<!--@php echo mobile_url('openshop_action',array('act'=>'delete'));@-->";
    var tuijianurl = "<!--@php echo mobile_url('openshop_action',array('act'=>'tuijian'));@-->";
    var viewurl  = "<!--@php echo mobile_url('detail');@-->";
    $(".one_good").click(function(){
        var isSale = request('isSale');
        var id = $(this).data('id');
        var is_top = $(this).data('istop');
        if(isSale.length == 0 || isSale == 1){   //销售中要下架
            var xiajia_ico = "__RESOURCE__/openshop/images/xiajia_ico.png";
            var zi = '下架';
        }else{   //需要上架
            xiajiaurl = "<!--@php echo mobile_url('openshop_action',array('act'=>'shangjia'));@-->";
            var xiajia_ico = "__RESOURCE__/openshop/images/shangjia_ico.png";
            var zi = '上架';
        }

        if(is_top == 1){  //需要取消推荐
            tuijianurl += "&is_top=0";
            var tuijian_ico = "__RESOURCE__/openshop/images/quxiao_tuijian_ico.png";
            var tuijian_zi = '消荐';
        }else{   // 进行推荐
            tuijianurl += "&is_top=1";
            var tuijian_ico = "__RESOURCE__/openshop/images/tuijian_ico.png";
            var tuijian_zi = '推荐';
        }
        xiajiaurl = xiajiaurl+"&dishid="+id;
        deleteurl = deleteurl+"&dishid="+id;
        tuijianurl = tuijianurl+"&dishid="+id;
        viewurl = viewurl+"&id="+id+"&accesskey="+accesskey;
        var htmlstr = "<div class='act_good'>" +
                            "<div><a href='javascript:;' data-url='"+ tuijianurl +"' data-istop='"+ is_top +"' data-id='"+ id +"'><img src='"+ tuijian_ico +"' alt=''><span>"+ tuijian_zi +"</span></a></div>"+
                            "<div><a href='javascript:;' data-url='"+ xiajiaurl +"' data-id='"+ id +"'><img src='" +xiajia_ico+ "' alt=''><span>"+ zi +"</span></a></div>"+
                            "<div><a href='"+ viewurl +"'><img src='__RESOURCE__/openshop/images/view_ico.png' alt=''><span>预览</span></a></div>"+
                            "<div><a href='javascript:;' data-url='"+ deleteurl +"' data-id='"+ id +"'><img src='__RESOURCE__/openshop/images/delete_ico.png' alt=''><span>删除</span></a></div>"+
                      "</div>";
        $("#myModal2").modal('show');
        $("#myModal2 .modal-title").html('编辑商品');
        $("#myModal2 .modal-body").html(htmlstr);
    })

    //推荐
    $(document).delegate('.act_good div:first-child>a','click',function(){
        var id = $(this).data('id');
        var url = $(this).data('url');
        var is_top = $(this).data('istop');
        $("#myModal2").modal('hide');
        tip('正在操作中！');
        $.getJSON(url,function(data){
            tip(data.message,1);
            if(data.errno == 200){
                if(is_top == 1)
                    $("#show_list_"+id).data('istop',0);
                else
                    $("#show_list_"+id).data('istop',1);
            }
        });
    })
    //下架
    $(document).delegate('.act_good div:nth-child(2)>a','click',function(){
        var id = $(this).data('id');
        var url = $(this).data('url');
        $("#myModal2").modal('hide');
        tip('正在操作中！');
        $.getJSON(url,function(data){
            tip(data.message,1);
            if(data.errno == 200){
                $("#show_list_"+id).remove();
            }
        });
    })
    //删除
    $(document).delegate('.act_good div:last-child>a','click',function(){
        var id = $(this).data('id');
        var url = $(this).data('url');
        $("#myModal2").modal('hide');
        tip('正在操作中！');
        $.get(url,'',function(data){
            tip(data.message,1);
            if(data.errno == 200){
                $("#show_list_"+id).remove();
            }
        },'json');
    })

    $(function(){
        var isSale = request('issale');
        var order  = request('order');
        if(isSale == 1 || isSale.length == 0){  //销售中
            //To do what
        }else if(isSale == 0){  //未上架
            $(".order11 button").html('未上架<span class="caret"></span>');
            $(".order11 button").data('issale',0);
            $(".order11 ul li a").html("销售中");
            $(".order11 ul li a").data('issale',1);
        }

        if(order == 'sales'){
            $(".order22 button").html('销量排序<span class="caret"></span>');
            $(".order22 button").data('order','sales');
            $(".order22 ul li").eq(1).find('a').html("最新排序");
            $(".order22 ul li").eq(1).find('a').data('order','createtime');
        }else if(order == 'commision'){
            $(".order22 button").html('佣金排序<span class="caret"></span>');
            $(".order22 button").data('order','sales');
            $(".order22 ul li").eq(2).find('a').html("最新排序");
            $(".order22 ul li").eq(2).find('a').data('order','createtime');
        }else if(order == 'marketprice'){
            $(".order22 button").html('售价排序<span class="caret"></span>');
            $(".order22 button").data('order','marketprice');
            $(".order22 ul li").eq(3).find('a').html("最新排序");
            $(".order22 ul li").eq(3).find('a').data('order','createtime');
        }else if(order == 'collect_num'){
            $(".order22 button").html('收藏排序<span class="caret"></span>');
            $(".order22 button").data('order','collect_num');
            $(".order22 ul li").eq(4).find('a').html("最新排序");
            $(".order22 ul li").eq(4).find('a').data('order','createtime');
        }
    })

    $(".order11 ul li a").click(function(){
        var isSale = $(this).data('issale');
        var order = $(".order22 button").data('order');
        goUrl(isSale,order);

    })
    $(".order22 ul li a").click(function(){
        var order = $(this).data('order');
        var isSale = $(".order11 button").data('issale');
        goUrl(isSale,order);

    })

    function goUrl(isSale,order){
        var url = "<!--@php echo mobile_url('openshop_mange',array('op'=>'list'));@-->";
        url += "&isSale="+ isSale +"&order="+ order;
        var keyword = $("input[name='keyword']").val();
        if(keyword != ''){
            url = url + "&keyword="+keyword;
        }
        window.location.href = url;
    }

    //获取URL参数
    function request(paras)
    {
        var url = location.href;
        url = decodeURI(url);
        var paraString = url.substring(url.indexOf("?")+1,url.length).split("&");
        var paraObj = {}
        for (i=0; j=paraString[i]; i++){
            paraObj[j.substring(0,j.indexOf("=")).toLowerCase()] = j.substring(j.indexOf("=")+1,j.length);
        }
        var returnValue = paraObj[paras.toLowerCase()];
        if(typeof(returnValue)=="undefined"){
            return "";
        }else{
            return returnValue;
        }
    }

    function tip(msg,autoClose){
        var div = $("#poptip");
        var content =$("#poptip_content");
        if(div.length<=0){
            div = $("<div id='poptip'></div>").appendTo(document.body);
            content =$("<div id='poptip_content'>" + msg + "</div>").appendTo(document.body);
        }
        else{
            content.html(msg);
            content.show(); div.show();
        }
        if(autoClose) {
            setTimeout(function(){
                content.fadeOut(500);
                div.fadeOut(500);

            },1000);
        }
    }
    function tip_close(){
        $("#poptip").fadeOut(1000);
        $("#poptip_content").fadeOut(1000);
    }
</script>
</body>
</html>