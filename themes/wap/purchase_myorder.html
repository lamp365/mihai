<!DOCTYPE html>
<html>
<head>
	<title>我的订单</title>
	<meta charset="utf-8">
	 <meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
	<script type="text/javascript" src="__RESOURCE__/recouse/js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="__RESOURCE__/script/common.js"></script>
	<link type="text/css" rel="stylesheet" href="__RESOURCE__/mobile/style/bootstrap.css">
	<script type="text/javascript"	src="__RESOURCE__/recouse/js/jquery.lazyload.min.js"></script>
    <script type="text/javascript" src="__RESOURCE__/script/angular.min.js"></script>
	<link type="text/css" rel="stylesheet" href="__RESOURCE__/mobile/style/common.mobile.css">
	<link type="text/css" rel="stylesheet" href="__RESOURCE__/recouse/css/bjcommon.css">
	<script type="text/javascript" src="__RESOURCE__/script/cascade.js"></script>
	<script type="text/javascript" src="__RESOURCE__/recouse/js/swiper.js"></script>
	<script type="text/javascript" src="__RESOURCE__/recouse/bootstrap3/js/bootstrap.min.js"></script>
<style type='text/css'>
	.myoder .myoder-detail .price span.btn{  padding-right:5px;}
	.myoder .myoder-detail .price span.btn:empty{display: none}
	.my_nav div.cur a{padding-bottom:0;border-bottom:3px solid #e4393c;color:#e4393c}
	.modal-body  img{
			width: 100%;
		}
		.ajax-load {
			text-align: center;
		}
		.ajax-load img{
			width: 20px;
			height: 20px;			
		}
		.loading{
			width: auto !important;
		}
</style>

<link type="text/css" rel="stylesheet" href="__RESOURCE__/mobile/style/style.css">

</head>

<script>
	jQuery(document).ready(function($) {
		$("img.lazy").lazyload({
			placeholder : "__RESOURCE__/recouse/images/ajax-loader.gif", // 占位图
			threshold : 200, //控制灵敏度
			effect : "fadeIn"
		});
		
	});
</script>

<body style="padding-top:0px;margin:0 auto;">
<div class="main">
<div class="my_nav">
	<div class="swiper-container ">
		<div class="my_nav swiper-wrapper">
            <div class='<!--@php  if($status==99) echo "cur"; @--> swiper-slide' ><a href="<!--@php  echo mobile_url('purchase_myorder',array('status'=>99))@-->">全部</a></div>
            <div class="<!--@php  if($status==0) echo "cur"; @--> swiper-slide" ><a href="<!--@php  echo mobile_url('purchase_myorder',array('status'=>0))@-->">待付款</a></div>
            <div class="<!--@php  if($status==1) echo "cur"; @--> swiper-slide" ><a href="<!--@php  echo mobile_url('purchase_myorder',array('status'=>1))@-->">已付款</span></a></div>
            <div class="<!--@php  if($status==2) echo "cur"; @--> swiper-slide" ><a href="<!--@php  echo mobile_url('purchase_myorder',array('status'=>2))@-->">已发货</span></a></div>
            <div class="<!--@php  if($status==3) echo "cur"; @--> swiper-slide" ><a href="<!--@php  echo mobile_url('purchase_myorder',array('status'=>3))@-->">已完成</a></div>
            <div class="<!--@php  if($status==34) echo "cur"; @--> swiper-slide" ><a href="<!--@php  echo mobile_url('purchase_myorder',array('status'=>34))@-->">已退款</a></div>
            <div class="<!--@php  if($status==14) echo "cur"; @--> swiper-slide" ><a href="<!--@php  echo mobile_url('purchase_myorder',array('status'=>14))@-->">已退货</a></div>
	    </div>
    </div>



<!--@php  if(count($listorder)<=0) { @-->
<div class="myoder" style='text-align:center;color:#aaa;padding:30px;'>
    您暂时没有任何订单!
</div>
<!--@php  } @-->
<div class="myoderlist" style='margin-bottom:40px;'>
<!--@php  if(is_array($listorder)) { foreach($listorder as $item) { @-->
<div class="myoder">
	<div class="myoder-hd">
		<span class="pull-left">订单编号：<!--@php  echo $item['ordersn'];@--></span>
		<span class="pull-right"><!--@php  echo date('Y-m-d H:i', $item['createtime'])@--></span>
	</div>
	<!--弹出的商品详情框-->
	 <div class='modal fade product-detail' tabindex='-1' role='dialog' aria-labelledby='myLargeModalLabel' aria-hidden='true'>  
		<div class='modal-dialog modal-lg'>
			<div class='modal-content'>
				<div class='modal-header'> 
					<button type='button' class='close' data-dismiss='modal' style="margin-top: -10px;">
						<span aria-hidden='true'>&times;</span>
						<span class='sr-only'>Close</span>
					</button>
					<h4 class='modal-title' id='myModalLabel'></h4>
				</div>
				<div class='modal-body'>
					<div class="ajax-load"><img src="__RESOURCE__/recouse/images/ajax-loader.gif"></div>
				</div>
			</div>
		</div>
	</div>	
    <!--@php  if(count($item['goods'])==1) { @-->
	<!--@php  if(is_array($item['goods'])) { foreach($item['goods'] as $goods) { @-->
	<div class="myoder-detail">
		<a href="javascript:;" class="product-img" product_id="<!--@php echo $goods['aid']; @-->" >
			<img data-original="<!--@php  echo $goods['thumb'];@-->" class="lazy" src="images/loading.gif" width="160">
		</a>
		<div class="pull-left">
			<div class="name">
				<a href="javascript:;" class="product-name" product_id="<!--@php echo $goods['aid']; @-->">					
					<!--@php  echo $goods['title'];@-->
				</a>
			</div>
			<div class="price">
				<span>¥<!--@php  echo $goods['marketprice'];@--> * <!--@php  echo $goods['total'];@--></span>
				<span class="btn btn-xs btn-success"><!--@php if($item['isdraw']==1){ echo '抽奖团'; }else{ echo getGoodsType($item['ordertype']); }@--></span>
			</div>
		</div>
		<div class="status"  style="text-align: right">
			<!--@php echo $status_ln[$item['status']];@-->
			<!--@php if ($item['status'] == 0 ){ @-->
			<br/><a href="<!--@php  echo mobile_url('purchase_myorder', array('orderid' => $item['id'], 'op' => 'cancelsend','fromstatus'=>$status))@-->" class="btn btn-default pull-right btn-xs" style="margin-top: 5px;">取消订单</a>
			<!--@php } @-->
		</div>
	</div>
	<!--@php  } } @-->
        <!--@php  } else { @-->
       
	<div class="myoder-detail">
             <!--@php  if(is_array($item['goods'])) { foreach($item['goods'] as $goods) { @-->
		<a href="javascript:;" class="product-img" product_id="<!--@php echo $goods['aid']; @-->">
			<img data-original="<!--@php  echo $goods['thumb'];@-->" width="160" class="lazy" src="images/loading.gif">
		</a>
                <!--@php  } } @-->
		<div class="status" style="text-align: right">
			<!--@php echo $status_ln[$item['status']]; @-->
			<!--@php if ($item['status'] == 0 ){ @-->
			<br/><a href="<!--@php  echo mobile_url('purchase_myorder', array('orderid' => $item['id'], 'op' => 'cancelsend','fromstatus'=>$status))@-->" class="btn btn-default pull-right btn-xs" style="margin-top:5px ;">取消订单</a>
			<!--@php } @-->
		</div>
	</div>
	
        <!--@php  } @-->

	<div class="myoder-total">
		<span>共：<span class="false">
					<!--@php  if($item['dispatchprice']<=0) { @-->
                        <!--@php  echo $item['price'];@--> 元
					<!--@php  } else { @-->
                        <!--@php  echo $item['price'];@--> 元 
                         <span style="font-size: 12px;">(含运费<!--@php echo $item['dispatchprice'];@-->/税费: <!--@php  echo $item['taxprice'];@-->) </span>
					<!--@php  } @-->
				 </span>
			<!--@php  if($item['hasbonus']>0) { @-->
				  <span style="color:green"> ( 已优惠：<!--@php  echo $item['bonusprice'];@--> 元)</span>
			<!--@php  }  @-->
		</span>
	 	<a href="<!--@php  echo mobile_url('purchase_myorder', array('orderid' => $item['id'], 'op' => 'detail','fromstatus'=>$status))@-->" class="btn btn-default pull-right btn-xs" >订单详情</a>
	</div>
</div>
<!--@php  } } @--></div><!--@php  echo $pager; @-->
<!--@php include themePage('purchase_footer');@-->
<script src="__RESOURCE__/recouse/js/zepto.min.js" type="text/javascript"></script>
<script type="text/javascript">
	 var swiper = new Swiper('.swiper-container', {
        pagination: '.swiper-pagination',
        slidesPerView: 'auto',
        paginationClickable: true,
        spaceBetween: 0,
        freeMode: true
    });
    
    //点击商品图片显示产品详情
		$(".product-img").on("click",function(){	
			$(this).parent(".myoder-detail").siblings(".product-detail").modal();		
			var content_id = $(this).attr("product_id");			
			var content = $(this).parent(".myoder-detail").siblings(".product-detail").find(".modal-body");	
			var title = $(this).parent(".myoder-detail").siblings(".product-detail").find(".modal-title"); //放title的地方
			var content_len = content.children().length;		
			//如何已有详情直接返回
			if( content_len > 1){
				return false;
			}else{				
				$.post("<!--@php  echo mobile_url('purchase_order')@-->",{type:'get_content',id:content_id},function(data){
					console.log(data);
					if(data.errno == 200){
						content.html(data.message.content);
						title.html(data.message.title);
					}else{
						alert(data.message);
					}
				},'json')
			};
		})
		//点击商品名称显示产品详情
		$(".product-name").on("click",function(){	
			$(this).parent().parent().parent().siblings(".product-detail").modal();		
			var content_id = $(this).attr("product_id");	
			var content = $(this).parent().parent().parent().siblings(".product-detail").find(".modal-body");//放详情的地方
			var title = $(this).parent().parent().parent().siblings(".product-detail").find(".modal-title"); //放title的地方
			var content_len =content.children().length;				
			//如何已有详情直接返回
			if( content_len > 1){
				return false;
			}else{
				$.post("<!--@php  echo mobile_url('purchase_order')@-->",{type:'get_content',id:content_id},function(data){					
					if(data.errno == 200){
						content.html(data.message.content);	
						title.html(data.message.title);
					}else{
						alert(data.message);
					}
				},'json')
			};
		})
</script>



