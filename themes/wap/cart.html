<!--@php  include themePage('header'); @-->
<link type="text/css" rel="stylesheet" href="__RESOURCE__/mobile/style/style.css">
<!-- cart放在style.css后面 请勿更改顺序 -->
<!--@php css_url('cart'); @-->
<div class="main">
<script type="text/javascript" src="__RESOURCE__/mobile/images/jquery.gcjs.js"></script>


<style>
.shopcart-footer{margin-bottom:49px;}

</style>
<div class="cart_title" >
   <span class="return"><img src="__RESOURCE__/recouse/images/return.png" width="10px" height="16px"></span> 购物车(<span id="cart_title_num"><!--@php echo count($list); @--></span>)
</div>
<div class="shopcart-main">

    <div style="text-align:center;padding:50px 0 50px 0; <!--@php  if(count($list)>0) { @-->display:none<!--@php  } @-->" id="cartempty">
        <img src="__RESOURCE__/mobile/images/icon_cart_empty.png"><br><br>
        <span style="color:#adadad">您的购物车空空如也，赶紧去选购吧~~</span>
    </div>
<!--@php  if(is_array($list) && !empty($list)) { @-->
        <div class="shopcart-item">
        <form action="<!--@php echo mobile_url('myorder1') @-->" method="post" name="cartform">
        <!--@php  foreach($list as $val) { @-->
        <!--@php  foreach($val as $v) { @-->
        <!--@php  $goods = $v['goods'];$storeInfo = $v['store'];@-->
        
            <div class="cart-area">
                <div class="shop-top clearfix">
                    <div class="cart_l cart-shop-name-l">
                        <input type="checkbox"  class="cart_checkbox small_all_choose" onclick="small_all_choose(this)">
                        <label></label>
                    </div>
                    <div class="cart_r cart-shop-name-r" style="font-size:12px;">
                        <span class="cart-shop-name mui-ellipsis"><!--@php echo $storeInfo['sts_name'] @--></span><i class="icon-angle-right" aria-hidden="true"></i>
                        <div class="pull-right ">
                            <span class="coupons-btn" onclick="couponsBtn(this)">领券</span>
                            <span class="cart-edit" state="edit" onclick="cartEdit(this)">编辑</span>
                        </div>
                    </div>
                </div>
                <!--@php  if( count($val) == 1) { @-->
                <div class="cart_list" id="item_11">
                    <div class="clearfix cart-right">
                        <div class="cart_l">
                            <input type="checkbox" id="list_index_11" class="cart_checkbox child_checkbox " name="cart_ids[]" value="11"><label for="list_index_11"></label>
                            <input type="hidden" value="995" id="hide_kucun_11">
                        </div>
                        <div class="cart_r">
                            <div class="pic">
                                <img data-original="<!--@php echo download_pic($goods['thumb'],200,200,2); @-->" class="lazy" src="__RESOURCE__/recouse/images/lazy200.jpg" >
                            </div>

                            <div class="shopcart-item-detail">
                                <div class="shop_title">
                                    <div class="name"><a href="index.php?mod=mobile&amp;id=319&amp;name=shopwap&amp;do=detail"><!--@php echo $goods['title'] @--></a></div>
                                    <p class="description util-ellipsis" onclick="specShow(this)">浅褐色, 5.5g<i class="specShow icon-angle-down" aria-hidden="true"></i></p>

                                    <div class="input-group">
                                        <span class="input-group-btn">
                                            <button class="btn btn-default btn-sm btn-reduce" type="button" onclick="reduceNum(11)"><i class="icon-minus"></i></button>
                                        </span>
                                            <input type="tel" class="form-control input-sm pricetotal goodsnum" style="border-left:0;" value="4" price="78.00" pricetotal="312" id="goodsnum_11" cartid="11" maxbuy="0">
                                        <span class="input-group-btn">
                                            <button class="btn btn-default btn-sm btn-add" type="button" onclick="addNum(11,0)"><i class="icon-plus"></i></button>
                                        </span>
                                    </div>
                                </div>
                                <div class="price">
                                    ¥<span class="singletotalprice" style="font-weight:bold">￥<!--@php echo $goods['marketprice'] @--></span>
                                    <span class="old-price">￥<!--@php echo $goods['productprice'] @--></span>
                                    <span class="shuliang">×<span><!--@php echo $v['total'] @--></span></span>
                                    
                                </div>

                            </div>
                            <div class="cart-remove" onclick="cartRemove(this)">删除</div>
                        </div>
                    </div>
                    <div class="small-total">
                        <span class="description">小计:</span>
                        <span class="small-total-price">¥ <!--@php echo $v['totalprice']; @--></span>
                    </div>
                </div>
                <!--@php  }else{ @-->
                <div class="cart_list" id="item_32">
                    <div class="clearfix cart-right">
                        <div class="cart_l">
                            <input type="checkbox" id="list_index_31" class="cart_checkbox child_checkbox" name="cart_ids[]" value="32"><label for="list_index_31"></label>
                            <input type="hidden" value="493" id="hide_kucun_32">
                        </div>
                        <div class="cart_r">
                            <div class="pic">
                                <img data-original="http://odozak4lg.bkt.clouddn.com/20161125102058379fec319d7.jpg" class="lazy" src="__RESOURCE__/recouse/images/lazy200.jpg" >
                            </div>

                            <div class="shopcart-item-detail">
                                <div class="shop_title">
                                    <div class="name"><a href="index.php?mod=mobile&amp;id=3&amp;name=shopwap&amp;do=detail">performix sst燃脂胶囊顽固型运动减脂瘦身持久高效60粒补充能量</a></div>
                                    <p class="description util-ellipsis" onclick="specShow(this)">浅褐色, 5.5g<i class="specShow icon-angle-down"  aria-hidden="true"></i></p>
                                    <div class="input-group">
                                    <span class="input-group-btn">
                                        <button class="btn btn-default btn-sm btn-reduce" type="button" onclick="reduceNum(32)"><i class="icon-minus"></i></button>
                                    </span>
                                        <input type="tel" class="form-control input-sm pricetotal goodsnum" style="border-left:0;" value="1" price="310.00" pricetotal="310" id="goodsnum_32" cartid="32" maxbuy="0">
                                    <span class="input-group-btn">
                                        <button class="btn btn-default btn-sm btn-add" type="button" onclick="addNum(32,0)"><i class="icon-plus"></i></button>
                                    </span>
                                    </div>
                                </div>
                                <div class="price">
                                    ¥<span class="singletotalprice" style="font-weight:bold">310.00</span> <span class="shuliang">×<span>1</span></span>
                                   
                                </div>

                            </div>
                            <div class="cart-remove" onclick="cartRemove(this)">删除</div>
                        </div>
                    </div>
                    <div class="clearfix cart-right">
                        <div class="cart_l">
                            <input type="checkbox" id="list_index_32" class="cart_checkbox child_checkbox" name="cart_ids[]" value="32"><label for="list_index_32"></label>
                            <input type="hidden" value="493" id="hide_kucun_32">
                        </div>
                        <div class="cart_r">
                            <div class="pic">
                                <img data-original="http://odozak4lg.bkt.clouddn.com/20161125102058379fec319d7.jpg" class="lazy" src="__RESOURCE__/recouse/images/lazy200.jpg" >
                            </div>

                            <div class="shopcart-item-detail">
                                <div class="shop_title">
                                    <div class="name"><a href="index.php?mod=mobile&amp;id=3&amp;name=shopwap&amp;do=detail">performix sst燃脂胶囊顽固型运动减脂瘦身持久高效60粒补充能量</a></div>
                                    <p class="description util-ellipsis"  onclick="specShow(this)">浅褐色, 5.5g<i class="specShow icon-angle-down" aria-hidden="true"></i></p>
                                    <div class="input-group">
                                    <span class="input-group-btn">
                                        <button class="btn btn-default btn-sm btn-reduce" type="button" onclick="reduceNum(32)"><i class="icon-minus"></i></button>
                                    </span>
                                        <input type="tel" class="form-control input-sm pricetotal goodsnum" style="border-left:0;" value="1" price="310.00" pricetotal="310" id="goodsnum_32" cartid="32" maxbuy="0">
                                    <span class="input-group-btn">
                                        <button class="btn btn-default btn-sm btn-add" type="button" onclick="addNum(32,0)"><i class="icon-plus"></i></button>
                                    </span>
                                    </div>
                                </div>
                                <div class="price">
                                    ¥<span class="singletotalprice" style="font-weight:bold">310.00</span> <span class="shuliang">×<span>1</span></span>
                                    
                                </div>

                            </div>
                            <div class="cart-remove" onclick="cartRemove(this)">删除</div>
                        </div>
                    </div>
                    <div class="small-total">
                        <span class="description">小计:</span>
                        <span class="small-total-price">¥ 620.00</span>
                    </div>
                </div>
                <!--@php  } @-->
            </div>
            <!--@php }}  @-->
            <!-- <div class="cart-area">
                <div class="shop-top clearfix">
                    <div class="cart_l cart-shop-name-l">
                        <input type="checkbox" class="cart_checkbox small_all_choose" onclick="small_all_choose(this)">
                        <label ></label>
                    </div>
                    <div class="cart_r cart-shop-name-r" style="font-size:12px;">
                        <span class="cart-shop-name mui-ellipsis">笛爱儿特卖专场笛爱儿特卖专场笛爱儿特卖专场</span><i class="icon-angle-right" aria-hidden="true"></i>
                        <div class="pull-right ">
                            <span class="coupons-btn" onclick="couponsBtn(this)">领券</span>
                            <span class="cart-edit" state="edit" onclick="cartEdit(this)">编辑</span>
                        </div>
                    </div>
                </div>
                <div class="cart_list" id="item_32">
                    <div class="clearfix cart-right">
                        <div class="cart_l">
                            <input type="checkbox" id="list_index_31" class="cart_checkbox child_checkbox" name="cart_ids[]" value="32"><label for="list_index_31"></label>
                            <input type="hidden" value="493" id="hide_kucun_32">
                        </div>
                        <div class="cart_r">
                            <div class="pic">
                                <img data-original="http://odozak4lg.bkt.clouddn.com/20161125102058379fec319d7.jpg" class="lazy" src="__RESOURCE__/recouse/images/lazy200.jpg" >
                            </div>

                            <div class="shopcart-item-detail">
                                <div class="shop_title">
                                    <div class="name"><a href="index.php?mod=mobile&amp;id=3&amp;name=shopwap&amp;do=detail">performix sst燃脂胶囊顽固型运动减脂瘦身持久高效60粒补充能量</a></div>
                                    <p class="description util-ellipsis" onclick="specShow(this)">浅褐色, 5.5g<i class="specShow icon-angle-down"  aria-hidden="true"></i></p>
                                    <div class="input-group">
                                    <span class="input-group-btn">
                                        <button class="btn btn-default btn-sm btn-reduce" type="button" onclick="reduceNum(32)"><i class="icon-minus"></i></button>
                                    </span>
                                        <input type="tel" class="form-control input-sm pricetotal goodsnum" style="border-left:0;" value="1" price="310.00" pricetotal="310" id="goodsnum_32" cartid="32" maxbuy="0">
                                    <span class="input-group-btn">
                                        <button class="btn btn-default btn-sm btn-add" type="button" onclick="addNum(32,0)"><i class="icon-plus"></i></button>
                                    </span>
                                    </div>
                                </div>
                                <div class="price">
                                    ¥<span class="singletotalprice" style="font-weight:bold">310.00</span> <span class="shuliang">×<span>1</span></span>
                                   
                                </div>

                            </div>
                            <div class="cart-remove" onclick="cartRemove(this)">删除</div>
                        </div>
                    </div>
                    <div class="clearfix cart-right">
                        <div class="cart_l">
                            <input type="checkbox" id="list_index_32" class="cart_checkbox child_checkbox" name="cart_ids[]" value="32"><label for="list_index_32"></label>
                            <input type="hidden" value="493" id="hide_kucun_32">
                        </div>
                        <div class="cart_r">
                            <div class="pic">
                                <img data-original="http://odozak4lg.bkt.clouddn.com/20161125102058379fec319d7.jpg" class="lazy" src="__RESOURCE__/recouse/images/lazy200.jpg" >
                            </div>

                            <div class="shopcart-item-detail">
                                <div class="shop_title">
                                    <div class="name"><a href="index.php?mod=mobile&amp;id=3&amp;name=shopwap&amp;do=detail">performix sst燃脂胶囊顽固型运动减脂瘦身持久高效60粒补充能量</a></div>
                                    <p class="description util-ellipsis"  onclick="specShow(this)">浅褐色, 5.5g<i class="specShow icon-angle-down" aria-hidden="true"></i></p>
                                    <div class="input-group">
                                    <span class="input-group-btn">
                                        <button class="btn btn-default btn-sm btn-reduce" type="button" onclick="reduceNum(32)"><i class="icon-minus"></i></button>
                                    </span>
                                        <input type="tel" class="form-control input-sm pricetotal goodsnum" style="border-left:0;" value="1" price="310.00" pricetotal="310" id="goodsnum_32" cartid="32" maxbuy="0">
                                    <span class="input-group-btn">
                                        <button class="btn btn-default btn-sm btn-add" type="button" onclick="addNum(32,0)"><i class="icon-plus"></i></button>
                                    </span>
                                    </div>
                                </div>
                                <div class="price">
                                    ¥<span class="singletotalprice" style="font-weight:bold">310.00</span> <span class="shuliang">×<span>1</span></span>
                                    
                                </div>

                            </div>
                            <div class="cart-remove" onclick="cartRemove(this)">删除</div>
                        </div>
                    </div>
                    <div class="small-total">
                        <span class="description">小计:</span>
                        <span class="small-total-price">¥ 620.00</span>
                    </div>
                </div>
            </div> -->
            
            
        </form>
    </div>
<!--@php  } @-->
    <div class="cart_foot">
    <div class="fahuodi">
            <div class="cart_l cart-shop-name-l">
                <input type="checkbox" id="choose_all" class="cart_checkbox" onclick="choose_or_not_choose()">
                <label for="choose_all"></label>
            </div>
            <div style="float:left;">全选</div>
        </div>
        <div class="goods_money">
            <table>
                <tbody>
                    <tr>
                        <td style="padding-right:15px;color:#D22147;">总计：¥<span id="huodong_zonge">622.00</span></td>
                    </tr>
                </tbody>
            </table>
            <div class="jiesuan">
                <div id="jiesuan" onclick="checkcredit()">结算(3)</div>
            </div>
        </div>
    </div>
</div>


<div class="zhezhao"></div>
<!-- 优惠券弹窗 -->
<div class="zhezhao-child">
    <div class="fadein-title">优惠券<span class="zhezhao-close" onclick="zzClose()">&times;</span></div>
    <div class="zhezhao-list ">
        <div class="zhezhao-left">
            <div class="zhezhao-price">￥10</div>
            <div class="zhezhao-price2">满99减10</div>
            <div class="zhezhao-time">有效期：2017.4.19-2017.4.31</div>
        </div>
        <div class="zhezhao-btn" onclick="zzBtn(this)">立即领取</div>
    </div>
    <div class="zhezhao-list ">
        <div class="zhezhao-left">
            <div class="zhezhao-price">￥10</div>
            <div class="zhezhao-price2">满99减10</div>
            <div class="zhezhao-time">有效期：2017.4.19-2017.4.31</div>
        </div>
        <div class="zhezhao-btn" onclick="zzBtn(this)">立即领取</div>
    </div>
</div>
<!-- 规格弹窗 -->
<div class="spec-alert">
    <div class="spec-alert-1 clearfix">
        <div class="spec-alert-img">
            <img src="http://odozak4lg.bkt.clouddn.com/20161125102058379fec319d7.jpg">
        </div>
        <div class="spec-alert-spec">
            <div class="spec-price">￥9.9</div>
            <div class="spec-spec">已选"浅褐色","5.5g"</div>
        </div>
        <span class="zhezhao-close" onclick="specClose()">&times;</span>
    </div>
    <div class="spec-detail clearfix">
        <div>颜色</div>
        <ul class="color">
            <li class="spec-checked">浅褐色</li>
            <li>深灰色</li>
            <li>棕色</li>
            <li>浅褐色</li>
            <li>深灰色</li>
            <li>棕色</li>
        </ul>
    </div>
    <div class="spec-detail clearfix">
        <div>净含量</div>
        <ul class="spec">
            <li>5.5g</li>
            <li>6g</li>
            <li>100g</li>
        </ul>
    </div>
    <div class="buy-num">
        <span class="buy-num-span">购买数量</span>
        <div class="num-area clearfix">
            <span onclick="specMinus(this)">-</span>
            <input class="spec-num" type="text" value="10">
            <span onclick="specPlus(this)">+</span>
        </div>
    </div>
    <div class="spec-save" onclick="specSave(this)">确定</div>
    <input type="hidden" value="" class="spec-hidden">
    <input type="hidden" value="" class="color-hidden">
</div>
<!--@php include themePage('footer');@-->

<script type="text/javascript">
    $(function(){
        $("#choose_all").click();
        choose_or_not_choose();

        $(".goodsnum").blur(function(){
            var id = $(this).attr("cartid");
            if($(this).isInt()){
                var init_num = $("#item_" +id).find(".shuliang span").html();
                var num = parseInt( $("#goodsnum_" + id).val() );
                var maxbuy = parseInt( $(this).attr("maxbuy") );
                var kucun = parseInt($("#hide_kucun_" +id).val());
                if(num < 1){
                    //返回初始个数
                    $("#goodsnum_" + id).val(init_num);
                    tip("对不起，输入有误",1);
                    return;
                }
                if(num>kucun){
                    $("#goodsnum_" + id).val(init_num);
                    tip("对不起，库存不足",1);
                    return;
                }
                if(num > maxbuy && maxbuy>0){
                    $("#goodsnum_" + id).val(init_num);
                    tip("最多只能购买"+maxbuy+"件",1);
                    return;
                }

                $("#item_" +id).find(".shuliang span").html('1');
                updateCart(id,num);
                canculate();
            }
            else{
                $(this).val("1");
                $("#item_" +id).find(".shuliang span").html('1');
                updateCart(id,1);
                canculate();
            }
            
        })
        
        //编辑规格
        $(".spec-detail .color li").on("click",function(){
            $(this).addClass("spec-checked").siblings("li").removeClass("spec-checked");
            $(".color-hidden").val($(this).text());
        });
        $(".spec-detail .spec li").on("click",function(){
            $(this).addClass("spec-checked").siblings("li").removeClass("spec-checked");
            $(".spec-hidden").val($(this).text());
        });
        $(".spec-num").blur(function(){
            var num = $(this).val();
            if( isNaN(num) ){
                $(this).val(0);
            }
        })
    })
function clearCart(){
    if (confirm('确定要清空购物车吗？')) {
        tip("正在处理数据...");
        $.getJSON("<!--@php  echo mobile_url('mycart',array('op'=>'clear'));@-->", function(s){
            $(".shopcart-item").remove();
            $("#cartempty").show();
            $(".shopcart-item").hide();
            $(".cart_foot").hide();
            tip_close();
        });
    }
}
function removeCart(id){
    if (confirm('您确定要删除此商品吗？')) {
        tip("正在处理数据...");
        var url  = "<!--@php  echo mobile_url('mycart', array('op'=>'remove'))@-->" + "&id=" + id;
        $.getJSON(url, function(s){
            $("#item_" + s.cartid).remove();
            if($(".cart_list").length<=0){
                $("#cartempty").show();
                $(".shopcart-item").hide();
                $(".cart_foot").hide();
            }
            tip_close();
            canculate();
        });
    }
}

$("#delbat_btn").click(function(){
    var isnum = 0;
    var idarr = [];
    $(".cart_list").each(function(){
        if($(this).find('.child_checkbox').is(':checked')){
            isnum ++;
            idarr.push($(this).find('.child_checkbox').val());
        }
    })
    
    if(isnum != 0){
        if(confirm("你确定要删除么？")){
            var ids = {ids:idarr};
            var url = "<!--@php echo mobile_url('mycart',array('op'=>'delbat')); @-->";
            tip('正在处理中！');
            $.post(url,ids,function(data){
                tip(data.message,1);
                if(data.errno == 200){
                    for(var i=0;i<idarr.length;i++){
                        var id = idarr[i];
                        $("#item_" + id).remove();
                    }
                     if($(".cart_list").length<=0){
                        $("#cartempty").show();
                        $(".shopcart-item").hide();
                        $(".cart_foot").hide();
                        $("#choose_all").prop("checked",false);
                    }
                    choose_or_not_choose();
                }

            },'json')
        }

    }else{
        tip('对不起你还没有选择！',1);
    }


})

function updateCart(id,num){
    
      var url  = "<!--@php  echo mobile_url('mycart', array('op'=>'update'))@-->" + "&id=" + id+"&num=" + num;
      $.getJSON(url, function(s){
      });
}

function addNum(id,maxbuy){
    var num = parseInt( $("#goodsnum_" + id).val() );
    var kucun = parseInt($("#hide_kucun_" +id).val());
    num++;
    if(num>kucun){
        tip("对不起，库存不足",1);
        return;
    }
    if(num > maxbuy && maxbuy>0){
        tip("最多只能购买"+maxbuy+"件",1);
        return;
    }
    $("#goodsnum_" + id).val(num);
    $("#item_" +id).find(".shuliang span").html(num);
    canculate();
    updateCart(id,num);
}
function checkcredit(){
    var ok = false;
    $(".child_checkbox").each(function(){
        if(this.checked){
            ok = true;
        }
    })
    if(ok){
        $("form[name='cartform']").submit();
    }else{
        tip('你还没有选择商品！',1);
    }

}
function reduceNum(id){
    var num = parseInt( $("#goodsnum_" + id).val() );
    if(num-1<=0){
        return;
    }
    num--;
    $("#goodsnum_" + id).val(num);
    $("#item_" +id).find(".shuliang span").html(num);
    canculate();
    updateCart(id,num);
}
function canculate(obj){
    var total = 0;
    var num = 0;
    var samll_num = 0;
    var small_total = 0;
    $(".child_checkbox").each(function(){
       if($(this).is(":checked")){
           num += 1;
           var price = $(this).closest('.cart_list').find(".singletotalprice").html();
           var geshu = $(this).closest('.cart_list').find(".shuliang span").html();
           total += parseFloat(price) * geshu;
       }
    });
    $(obj).parents(".cart_list").find(".child_checkbox").each(function(){
        if($(this).is(":checked")){
           samll_num += 1;
           var child_price = $(this).closest('.cart_list').find(".singletotalprice").html();
           var child_geshu = $(this).closest('.cart_list').find(".shuliang span").html();
           small_total += parseFloat(child_price) * child_geshu;
       }
    });
    if( samll_num == 0 ){
        $(obj).parents(".cart_list").siblings(".shop-top").find(".small_all_choose").prop("checked",false);
    }else{
        $(obj).parents(".cart_list").siblings(".shop-top").find(".small_all_choose").prop("checked",true);
    }
    total = parseFloat(total).toFixed(2);
    small_total = parseFloat(small_total).toFixed(2);
    $("#huodong_zonge").html(total);
    $("#pricetotal").html(total);
    $("#cart_title_num").html(num);
    $("#choose_num").html(num);
    $(obj).parents(".cart_list").find(".small-total-price").text("￥"+small_total);
    if(num == 0){
        //全选去掉
        $("#choose_all").prop("checked",false);
        $("#jiesuan").attr("disabled",true);
    }else{
        $("#choose_all").prop("checked",true);
        $("#jiesuan").attr("disabled",false);
    }
}
//每个店铺的全选按钮
function small_all_choose(obj){
    var isChooseAll = $(obj).is(":checked");
    var small_total = 0;
    $(obj).parents(".shop-top").siblings(".cart_list").find(".child_checkbox").each(function(){
        if(isChooseAll){
            $(this).prop("checked",true);
            var child_price = $(this).closest('.cart_list').find(".singletotalprice").html();
            var child_geshu = $(this).closest('.cart_list').find(".shuliang span").html();
            small_total += parseFloat(child_price) * child_geshu;
        }else{
            $(this).prop("checked",false);
        }
    })
    small_total = parseFloat(small_total).toFixed(2);
    $(obj).parents(".shop-top").siblings(".cart_list").find(".small-total-price").text("￥"+small_total);
    canculate();
    if(isChooseAll){
        $("#jiesuan").attr("disabled",false);
    }else{
        $("#jiesuan").attr("disabled",true);
    }
}
//领券
function couponsBtn(obj){
    $(".zhezhao").show();
    $(".zhezhao-child").slideDown("slow");
}
//关闭领券 
function zzClose(){
    $(".zhezhao-child").slideUp("slow",function(){
        $(".zhezhao").fadeOut();
    });
}
function specClose(){
    $(".spec-alert").slideUp("slow",function(){
        $(".zhezhao").fadeOut();
    })
}
//领取优惠券按钮
function zzBtn(obj){

}
//编辑
function cartEdit(obj){
    var remove_height = $(".cart-remove").height();
    $(".cart-remove").css("line-height",remove_height+"px");
    var state = $(obj).attr("state");
    //successing
    if( state == "successing" ){
        $(obj).text("编辑").attr("state","edit");
        $(obj).parents(".shop-top").siblings(".cart_list").find(".input-group").hide();
        $(obj).parents(".shop-top").siblings(".cart_list").find(".cart-remove").hide();
        $(obj).parents(".shop-top").siblings(".cart_list").find(".name").css("opacity",1);
        $(obj).parents(".shop-top").siblings(".cart_list").find(".specShow").hide().attr("spec","hide");
    }else if( state == "edit" ){
        $(obj).text("完成").attr("state","successing");
        $(obj).parents(".shop-top").siblings(".cart_list").find(".input-group").show();
        $(obj).parents(".shop-top").siblings(".cart_list").find(".cart-remove").show();
        $(obj).parents(".shop-top").siblings(".cart_list").find(".name").css("opacity",0);
        $(obj).parents(".shop-top").siblings(".cart_list").find(".specShow").show().attr("spec","show");
    }
}
//编辑的删除功能
function cartRemove(obj){
    confirm('确定要删除这件商品吗?','',function(isconfirm){
       if(isconfirm){
            $(obj).parents(".cart-right").remove();
            canculate();
       }
  },{confirmButtonText: '确认', cancelButtonText: '取消', width: 300});
}

//编辑规格项
function specShow(obj){
    var spec_show = $(obj).find(".specShow").attr("spec");
    if( spec_show == "show" ){
        $(".zhezhao").fadeIn();
        $(".spec-alert").slideDown("slow")
    }else{
        return false;
    }
}
//保存规格项
function specSave(obj){
    var spec_num = $(".spec-num").val();
    var color_val = $(".color-hidden").val();
    var spec_val = $(".spec-hidden").val();
    if( color_val == "" ){
        alert("请选择颜色");
        return false;
    }
    if( color_val == "" ){
        alert("请选择净含量");
        return false;
    }
    $(".zhezhao").fadeOut();
    $(".spec-alert").slideUp("slow");
}
//编辑-弹窗-减
function specMinus(obj){
    var spec_num = parseInt($(obj).siblings(".spec-num").val());
    var new_num = 0;
    if( 0 >= spec_num ){
        $(obj).siblings(".spec-num").val(0);
        return false;
    }else{
        new_num = spec_num - 1;
        $(obj).siblings(".spec-num").val(new_num);
    }
}
//编辑-弹窗-加
function specPlus(obj){
    var spec_num = parseInt($(obj).siblings(".spec-num").val());
    spec_num += 1;
    $(obj).siblings(".spec-num").val(spec_num);
}

function choose_or_not_choose(){
    var isChooseAll = $("#choose_all").is(":checked");
    $(".child_checkbox").each(function(){
        if(isChooseAll){
            $(this).prop("checked",true);
        }else{
            $(this).prop("checked",false);
        }
    })
    $(".small_all_choose").each(function(){
        if(isChooseAll){
            $(this).prop("checked",true);
        }else{
            $(this).prop("checked",false);
        }
    })
    canculate();
    if(isChooseAll){
        $("#jiesuan").attr("disabled",false);
    }else{
        $("#jiesuan").attr("disabled",true);
    }
}

$(".child_checkbox").click(function(){
    canculate(this);
})
$(".return").click(function(){
    window.history.back(-1);
})
</script>
<script language='javascript'>
function tip(msg,autoClose){
     var div = $("#poptip");
     var content =$("#poptip_content");
     if(div.length<=0){
         div = $("<div id='poptip'></div>").appendTo(document.body);
         content =$("<div id='poptip_content'>" + msg + "</div>").appendTo(document.body);
     }
     else{
         content.html(msg);
         content.show(); div.show();
     }
     if(autoClose) {
        setTimeout(function(){
            content.fadeOut(500);
            div.fadeOut(500);

        },1000);
     }
}
function tip_close(){
    $("#poptip").fadeOut(500);
     $("#poptip_content").fadeOut(500);
}
</script>
</body>
</html>