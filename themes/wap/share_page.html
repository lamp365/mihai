<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
	    <meta name="apple-mobile-web-app-capable" content="yes">
	    <meta name="apple-mobile-web-app-status-bar-style" content="black">
	    <meta name="format-detection" content="telephone=no">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
		<meta name="applicable-device"content="pc,mobile"/>
		<title>觅海新人大礼包！</title>
		<link rel="shortcut icon" href="favicon.ico"/>
		<link rel="stylesheet" type="text/css" href="__RESOURCE__/recouse/css/share_page.css"/>
		<link type="text/css" rel="stylesheet" href="<?php echo RESOURCE_ROOT;?>addons/common/beAlert/css/BeAlert.css" />
		<script type="text/javascript"	src="__RESOURCE__/recouse/js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="<?php echo RESOURCE_ROOT;?>addons/common/beAlert/js/beAlert.js"></script>
		<style>
		.BeAlert_box  .BeAlert_title{
			font-size: 14px;
		}
		</style>
	</head>
	<body>
		
		<!--头部-->
		<div class="share_page_top">
			<img src="__RESOURCE__/recouse/images/share_page_top.png" />
		</div>
		<!--输入领取模块-->
		<div class="share_page_get">
			<!--广告位-->
			<div class="ad_board">
				<!--@php if(empty($cat_pic)){  @-->
				<img src="__RESOURCE__/recouse/images/ad_img.png" />
				<!--@php }else{ @-->
				<img src="__RESOURCE__/recouse/images/<!--@php echo $cat_pic; @-->" />
				<!--@php } @-->
			</div>
			<!--分割线-->
			<h3></h3>
			<!--输入框-->
			<div class="input_box">
				<input type="number" id="mobile" name="mobile" value="" placeholder="在此输入手机号领取"/>
				<button type="button"  id="liji_get" value="" class="btn">立即领取</button>
			</div>
		</div>
		<!--购物推荐-->
		<div class="share_page_recommend">
			<!--@php if(!empty($cat_goods)){ @-->
			<div class="title">
				<p class="title_tag"> </p>
				<p style="font-size:18px;">觅海购物推荐</p>
				<p class="title_tag"> </p>
			</div>
			<!--商品列表-->
			<div class="dishlist">
				<ul>
					<!--@php foreach($cat_goods as $key => $one_good){ @-->
					<!--@php if($key % 2==0){  @-->
					<li>
						<div class="img_box">
							<a href="<!--@php  echo mobile_url('detail', array('id' => $one_good['id'],'op'=>'dish'))@-->" >
							<img src="<!--@php echo download_pic($one_good['thumb'],400,400,2);@-->" />
							</a>
						</div>
						<div class="detail_box">
							<div class="detail_content">
								<!--国家品牌-->
								<p class="brand"><!--@php $good_brand = getGoodsFromCountry($one_good['brand']); echo $good_brand['brand'];@--></p>
								<!--商品名称-->
								<p class="name">
									<a href="<!--@php  echo mobile_url('detail', array('id' => $one_good['id'],'op'=>'dish'))@-->" >
											<!--@php echo $one_good['headline'];@-->
									</a>
								</p>
								<!--商品详情-->
								<p class="detail">
									<!--@php echo htmlspecialchars_decode($one_good['advertising']);@-->
								</p>
								<!--价格-->
								<p class="price">
									新人价:<span>￥<!--@php echo $one_good['marketprice'];@--></span>
								</p>
							</div>
						</div>
					</li>
					<!--@php }else{ @-->
					<li>
						<div class="img_box">
							<a href="<!--@php  echo mobile_url('detail', array('id' => $one_good['id'],'op'=>'dish'))@-->" >
								<img src="<!--@php echo download_pic($one_good['thumb'],400,400,2);@-->" />
							</a>
						</div>
						<div class="detail_box">
							<div class="detail_content">
								<!--国家品牌-->
								<p class="brand"><!--@php $good_brand = getGoodsFromCountry($one_good['brand']); echo $good_brand['brand'];@--></p>
								<!--商品名称-->
								<p class="name">
									<a href="<!--@php  echo mobile_url('detail', array('id' => $one_good['id'],'op'=>'dish'))@-->" >
									<!--@php echo $one_good['headline'];@-->
									</a>
								</p>
								<!--商品详情-->
								<p class="detail">
									<!--@php echo htmlspecialchars_decode($one_good['advertising']);@-->
								</p>
								<!--价格-->
								<p class="price">
									新人价:<span>￥<!--@php echo $one_good['marketprice'];@--></span>
								</p>
							</div>
						</div>
					</li>
					<!--@php } @-->
					<!--@php } @-->
				</ul>
			</div>
			<!--@php } @-->
		</div>
		<!--底部-->
		<div class="share_page_bottom">
			<img  src="__RESOURCE__/recouse/images/share_page_bottom.png"/>
		</div>
		
		<!--遮罩层-->
		<div class="shade" onclick="shut_register()"></div>
		<!--注册框-->
		<div class="register_box">
			<div class="title">注册享优惠</div>
			<div class="input_box re_box">
				<input type="number" id="verify" name="verify" value="" placeholder="请输入验证码"/>
				<span class="get" onclick="sendsms(this)">获取验证码</span>
				<input type="password" id="password2" name="password" value="" placeholder="请设置密码"/>
				<button type="button" name="sub" value="" onclick="toregister()" class="btn">注册领取</button>
			</div>
		</div>
	</body>
	
	<script>
	//控制购物推荐模块，左右两边的高度一致
	$(".dishlist ul li").each(function(){
		var Imgw = $(this).find(".img_box").width();
		$(this).find(".img_box").height(Imgw);
		var img_box_h = $(this).find(".img_box").height();
		var detail_box_h = $(this).find(".detail_box").height();
		//图片更高
		if ( img_box_h > detail_box_h ){
			detail_box_h = img_box_h ;				
			$(this).find(".detail_box").height(detail_box_h);
			var detail_content= $(this).find(".detail_content").height();
			var detail_content_h = 0.5*(detail_box_h - detail_content);
			$(this).find(".detail_content").css("margin-top",detail_content_h);
		}else{
			img_box_h = detail_box_h ; 
			$(this).find(".img_box").height(img_box_h);
		}	
		$(this).find(".img_box").css("line-height",img_box_h+"px");		
	})
		
			
		//输入是正确的手机号才能领取
		$("#liji_get").click(function(){
			var mobile = $("#mobile").val();			
			if(!mobile){
				alert("请输入手机号！");
				return false;
			}else if( mobile.search(/^([0-9]{11})?$/) == -1 ) {
				alert('请输入正确的手机号码！');
				return false;
			}else{
				var url ="<!--@php echo mobile_url('miyou',array('op'=>'register'));@-->";
				$.post(url,{'type':'check','phone':mobile},function(data){
					if(data.errno == 200){
						//手机号正确，弹出注册框
						$(".shade").show();
						$(".register_box").show();
					}else{
						alert(data.message+'<div style="font-size: 12px;margin-top: 5px;color: #e5184c;">正在跳转<span class="daojishi">3</span>s</div>',function(){
							var daojishi = "";
							var cleardaojishi = setInterval(function(){
								daojishi = parseInt($(".daojishi").text());
								if( daojishi > 0 ){
									$(".daojishi").text(daojishi-1);
								}else{
									clearInterval(cleardaojishi);
									var url = "<!--@php  echo mobile_url('iclub',array('from'=>'fansindex','op'=>'list'))@-->";
									window.location.href = url;
								}
							},1000);
						});
						
					}
				},'json');
			}
		});
		
		//点击获取验证码，不用再判断手机号了正确与否了，之前已经判断过
    	function sendsms(obj) {
    		
    		//获取手机号
			var mobile = $(window.parent.document).find("#mobile").val();
			if(!mobile){
				alert("请输入手机号！");
			}else if(mobile.search(/^([0-9]{11})?$/) == -1) {
				alert('请输入正确的手机号码！');
			}else{
				var url ="<!--@php echo mobile_url('miyou',array('op'=>'register'));@-->";
				$.post(url, {'phone':mobile,'type':'getcode'}, function(data) {
					if(data.errno == 200){
						//调用发送验证码的方法
						settime(obj);
					}else{
						alert(data.message);
					}
				},'json');
			}
		}
    	
    	//发送验证码
	    var countdown = 120;
		function settime(obj) {				
			if (countdown == 0) {
				obj.removeAttribute("disabled");
				$(obj).text("获取验证码");
				countdown = 120;
				return;
			} else {
				obj.setAttribute("disabled", true);
				$(obj).text("重新发送(" + countdown + ")");
				countdown--;
			}
			setTimeout(function() {
				settime(obj)
			}, 1000)
		}
		
    	//关闭注册弹框
		function shut_register(){
			$(".shade").hide();
			$(".register_box").hide();
		}
		//点击弹出框的立即注册
		function toregister(){
			//获取手机号
			var mobile = $(window.parent.document).find("#mobile").val();
			if(!mobile){
				alert("请输入手机号！");
				return '';
			}else if(mobile.search(/^([0-9]{11})?$/) == -1) {
				alert('请输入正确的手机号码！');
				return '';
			}
			var code = $("#verify").val();
			if(code.length < 1){
				alert('请输入验证码！');
				return '';
			}
			var password = $("#password2").val();
			if(password.length < 6){
				alert('密码错误','密码不能为空，且至少6个字符');
				return '';
			}
			var url ="<!--@php echo mobile_url('miyou',array('op'=>'register'));@-->";
			$.post(url, {'phone':mobile,'password':password,'code':code,'type':'regedit'}, function(data) {
				if(data.errno == 200){
					shut_register();
					alert(data.message,'正在跳转中~');
					setTimeout(function(){
						var url = "<!--@php echo mobile_url('miyou',array('op'=>'invite')); @-->";
						window.location.href = url;
					},2000);

				}else{
					alert(data.message);
				}
			},'json');
		}
	</script>
</html>
