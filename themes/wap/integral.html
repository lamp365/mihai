<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" type="text/css" href="__RESOURCE__/recouse/css/bjdetail.css">
    <link href="__RESOURCE__/recouse/css/reset.css" rel="stylesheet" type="text/css">
	<link type="text/css" href="__RESOURCE__/recouse/bootstrap3/css/bootstrap.min.css" rel="stylesheet" />
	<link href="__RESOURCE__/recouse/css/bjcommon.css" rel="stylesheet" type="text/css" />
	<link type="text/css" rel="stylesheet" href="<?php echo RESOURCE_ROOT;?>addons/common/beAlert/css/BeAlert.css" />
	<title>积分兑换</title>
	<style type="text/css">
		.integral{
			max-width: 720px;
			margin:0 auto;
			margin-bottom: 20px;
		}
		.integral-tab-ul{
			overflow: hidden;
    		background: #52bfe6;
		}
		.integral-tab-ul li{
		    float: left;
		    width: 25%;
		    text-align: center;
		    height: 40px;
		    line-height: 40px;
		    color: #fff;
		}
		.integral .tab-div{
			display: none;
		}
		.integral-tab-ul li.li-active{
    		background-color: #19a6db;
		}
		.tab-div .input-div{
			width: 85%;
			margin: 0 auto;
		}
		.tab-div .input-div input,select{
		    border: 1px solid #efefef;
		    width: 100%;
		    height: 3em;
		    line-height: 3em;
		    margin-top: 1rem;
		    border-radius: 4px;
		    padding-left: 1rem;
    		box-sizing: border-box;
    		-webkit-tap-highlight-color: rgba(0,0,0,0);
		}
		.tab-div .activation{

		    background-color: red;
		    color: #fff;
		    text-align: center;
		    border-radius: 4px;
		    line-height: 2;
		    font-size: 1.5rem;
		    margin-top: 1rem;
		}
		.prompt-msg{
			margin-top: 1rem;
			text-align: center;
		    font-size: 1em;
		    color: #ff5f5f;
		}
		.integral-shop .integral-number{
		    line-height: 2em;
		    width: 96%;
		    margin: 0 auto;
		    background-color: #fff;
		    margin-bottom: 2%;
		    margin-top: 2%;
		    border-radius: 3px;
		    padding-left: 15px;
		    box-sizing: border-box;
		}
		.integral-shop .integral-number span{
			color:#FF2D4B;
		}
		.integral-activation{
			background-color: #fff;
			padding-bottom: 20px;
		}
		.integral-shop-list li{
		    float: left;
		    width: 47%;
		    background-color: #fff;
		    padding: 10px;
		    box-sizing: border-box;
		    margin-bottom: 2%;
		    border-radius: 3px;
		}
		.integral-shop-list li:nth-child(odd){
			margin-left: 2%;
			margin-right: 1%;
		}
		.integral-shop-list li:nth-child(even){
			margin-left: 1%;
			margin-right: 2%;
		}
		.integral-shop-list li img{
			width: 80%;
			display: block;
			max-width: 80%;
			margin:0 auto;
		}
		.integral-shop-list li .title{
			overflow: hidden;
		    text-overflow: ellipsis;
		    display: -webkit-box;
		    -webkit-line-clamp: 2;
		    -webkit-box-orient: vertical;
		    height: 42px;
		    margin-top: 5px;
		}
		.active{
			margin:0;
		}
		.progress-detail{
			position: absolute;
			font-size: 12px;
			color: #333;
			text-align: center;
			width: 100%;
			top: -1px;
		}
		.progress{
			width: 100%;
			margin-top: 5px;
		}
		.integral-shop-price{margin-top: 5px;}
		.integral-shop-price span{
			color:#FF2D4B;
		}
		.exchange{
			background: #ec3333;
		    color: #fff;
		    text-align: center;
		    line-height: 2;
		    margin-top: 10px;
		    border-radius: 5px;
		}
		#express{
			width: 85%;
		    height: 600px;
		    border: none;
		    margin-top: 1rem;
		    margin-left: 7.5%;
		    display: none;
		}
		.address{
			width: 100%;
			border:none;
		}
		.add-address{
			background-color: #d9534f;
		    border-color: #d43f3a;
		    color: #fff;
		    margin-left: 3%;
		    margin-top: 2%;
		    width: 150px;
		    text-align: center;
		    line-height: 35px;
		    border-radius: 4px;
		}
		.integral-shop .infobox {
		    border-radius: 3px;
		    overflow: hidden;
		    background: #fff;
		    width: 96%;
		    margin: 2% auto;
		}
		.integral-shop .infobox h2 {
			line-height: 30px;
		    padding: 0 15px;
		    border-radius: 5px 5px 0px 0px;
		    border-bottom: 1px solid #f5f5f5;
		}
		.integral-shop .infobox p{
		    border-bottom: 1px solid #f3f3f3;
		    padding: 10px 15px;
		    line-height: 18px;
		    font-size: 14px;
		    background-size: 14px;
		}
		.infobox-phone{
			float: right;
		}
		.btn{
			display: inline-block;
		    padding: 6px 12px;
		    margin-bottom: 0;
		    font-size: 14px;
		    font-weight: normal;
		    line-height: 1.428571429;
		    text-align: center;
		    white-space: nowrap;
		    vertical-align: middle;
		    cursor: pointer;
		    background-image: none;
		    border: 1px solid transparent;
		    border-radius: 4px;
		    -webkit-user-select: none;
		    -moz-user-select: none;
		    -ms-user-select: none;
		    -o-user-select: none;
		    user-select: none;
		}
		.record-list{
			margin-top: 8px;
		}
		.record-list li{
		    width: 96%;
		    margin: 0 auto;
		    background-color: #fff;
		    margin-bottom: 8px;
		    border-radius: 3px;
		    padding: 0 10px 10px 10px;
		    box-sizing: border-box;
		}
		.record-list .record-img{
			float: left;
			width: 20%;
		}
		.record-list .record-title{
		    float: left;
		    width: 60%;
		    padding-left: 10px;
		    box-sizing: border-box;
		    max-height: 65px;
		    overflow: hidden;
		}
		.record-list .record-state{
			float: left;
			width:20%;
			text-align: right;
		}
		.record-list .record-img img{
			width: 100%;
			box-sizing: border-box;
			display: block;
			max-width: 100%;
		}
		.record-time{
		    border-bottom: 1px dashed #e0e0e0;
		    box-sizing: border-box;
		    margin-bottom: 10px;
		    height: 30px;
		    line-height: 30px;
		}
		.consume-number{
			float: right;
		}
		.record-time-span{
			color: #999;
		}
		.state-success{
			color: #5cb85c;
		}
		.state-fail{
			color: #d9534f;
		}
		.state-info{
			color: #5bc0de;
		}
		.no-record{
			display: block;
			width: 100%;
			max-width: 100%;
		}
		.no-record-detail{
			text-align: center;
			margin-top: 15px;
			color: #6d6d6d;
    		font-size: 18px;
		}
		.input-div-title{
			text-align: center;color: #333;font-size: 20px;padding-top: 13px;position: relative;
		}
		.input-div-title-div{
			position: relative;    background-color: #fff;    width: 144px;    margin: 0 auto;    z-index: 3;
		}
		.input-div-title-line{
			position: absolute;    top: 28px;    width: 100%;    border-bottom: 1px #efefef solid;    z-index: 1;
		}
	</style>
</head>
<body>
	<div class="integral">
		<div class="integral-tab">
			<ul class="integral-tab-ul">
<!-- 				<li><span>激活积分</span></li> -->
				<li class="li-active"><span>积分商城</span></li>
				<li><span>兑换记录</span></li>
			</ul>
		</div>
		<!-- <div class="tab-div integral-activation" style="display: block;">
			<div class="input-div">
			积分激活
				<div class="input-div-title">
					<div class="input-div-title-div" >积分激活</div>
					<div class="input-div-title-line" ></div>
				</div>
				<input type="text" name="order-number" class="order-number" placeholder="请输入您的订单编号">
				<input type="text" name="phone-number" class="phone-number" placeholder="请输入您的手机号码">
				<div class="activation" onclick="activation()">激 活</div>
				<div class="prompt-msg">你成功兑换了1000积分</div>
			物流查询
				<div class="input-div-title">
					<div class="input-div-title-div" >物流查询</div>
					<div class="input-div-title-line" ></div>
				</div>
				<input type="text" name="logistics" class="logistics" placeholder="请输入您的快递单号">
				<select class="logistics-select">
					<option value="0">请选择快递</option>
					<option value="1" data-url="http://wap.xlobo.com/">贝海快递</option>
					<option value="2" class="tiantian" data-url="http://m.kuaidi100.com/result.jsp?com=tiantian&nu=">天天快递</option>
					<option value="3" class="tiantian" data-url="http://m.kuaidi100.com/result.jsp?com=ems&nu=">EMS查询</option>
					<option value="4" data-url="http://www.hjusaexpress.com/result.aspx">豪杰速递</option>
					<option value="5" data-url="http://www.yundaex.com/cn/index.php">韵达速递</option>
				</select>
				<div class="activation" onclick="search()">查 询</div>
			</div>
			<iframe id="express" src=""></iframe>
		</div> -->
<!-- 		积分商城 -->
		<div class="tab-div integral-shop" style="display: block;">
		<!--@php $returnurl = mobile_url('integral',array('mark'=>'address')); @-->
			<!--@php if($openid){  @-->
			<div class="integral-number">您的积分：<span><!--@php echo $member['credit'] @--></span></div>
			<!--@php }else{ @-->
			<div class="integral-number">您的积分：<span><a href="<!--@php echo mobile_url('login');@-->">未登录</a></span></div>
			<!--@php } @-->

	      <!--@php if($config['open_gift_change'] == 0){   @-->
	      		<img class="no-record" src="__RESOURCE__/recouse/images/no_record_bg.png">
				<div class="no-record-detail">暂无可兑换商品</div>
	      <!--@php }else{   @-->
	       	<div class="infobox">
				<h2>收货信息</h2>
				<!--@php if(!empty($defaultAddress)){ @-->
				<p class="address_item address_xinxi">
					<span><!--@php echo $defaultAddress['realname'];@--></span><span class="infobox-phone"><!--@php echo $defaultAddress['mobile'];@--></span>
					<br>
					<!--@php echo $defaultAddress['province'];@-->&nbsp;
					<!--@php echo $defaultAddress['city'];@-->&nbsp;
					<!--@php echo $defaultAddress['area'];@-->&nbsp;
					<!--@php echo $defaultAddress['address'];@-->
				</p>
				<!--@php } @-->
				<p style="border-bottom: none;">
					<button type="button" class="btn btn-danger" onclick="location.href='<!--@php  echo mobile_url('address',array('no_identy'=>1,'from'=>'integral','returnurl'=>urlencode($returnurl)))@-->'">管理收货地址</button>
				</p>
			</div>
	      <!--@php }   @-->

		     
	
	
			<ul class="integral-shop-list clearfix">
			<!--@php if(!empty($goods_list)){ foreach($goods_list as $items){ @-->
				<li>
					<img class="lazy" data-original="<!--@php echo download_pic($items['logo'],350,350,2);@-->" src="images/loading.gif">
					<div class="title"><!--@php echo $items['title'];@--></div>
					<div class="integral-shop-price">
						价值：<span>￥<!--@php echo $items['price'];@--></span>
					</div>
					<div class="progress" style="height: 15px;position:relative;">
						<!--@php $jindutiao = round($credit*100/$items['jifen_change'],2); @-->
		                <div class="progress-bar progress-bar-danger progress-bar-striped active" role="progressbar" aria-valuenow="" aria-valuemin="0" aria-valuemax="" style="width:<!--@php echo $jindutiao;@-->%;"></div>
		                 <div class="progress-detail"><span><!--@php echo $credit;@--></span>/<!--@php echo $items['jifen_change'];@--></div>
		            </div>
		            <div class="exchange" onclick="exchange(<!--@php echo $items['id'];@-->,<!--@php echo $items['jifen_change'];@-->)">立即兑换</div>
				</li>
			<!--@php }} @-->
			</ul>
		</div>
		<div class="tab-div">
			<ul class="record-list">
				<!--@php if(empty($changeRecorder)){  @-->
					<img class="no-record" src="__RESOURCE__/recouse/images/no_record_bg.png">
					<div class="no-record-detail">暂无兑换记录</div>
				<!--@php }else{  @-->
				<!--@php foreach($changeRecorder as $one_corder){   @-->
				<li class="clearfix">
					<div class="record-time">
						<span class="record-time-span"><!--@php echo date("Y-m-d H:i:s",$one_corder['createtime']);@--></span>
						<span class="consume-number"><!--@php echo $one_corder['jifen_change'];@-->积分</span>
					</div>
					<div class="record-img">
						<img src="<!--@php echo download_pic($one_corder['logo'],100,100,2);@-->">
					</div>
					<div class="record-title"><!--@php echo $one_corder['title'];@--></div>
					<!--@php if($one_corder['jifen_status'] == 1){ @-->
					<div class="record-state state-info">待审核中</div>
					<!--@php }else if($one_corder['jifen_status'] == 2){ @-->
					<div class="record-state state-success">审核成功</div>
					<!--@php }else{ @-->
					<div class="record-state state-fail">审核失败</div>
					<!--@php } @-->
				</li>
				<!--@php } @-->
				<!--@php }  @-->

			</ul>
		</div>
	</div>
	<script type="text/javascript" src="__RESOURCE__/recouse/js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="__RESOURCE__/recouse/bootstrap3/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="<?php echo RESOURCE_ROOT;?>addons/common/beAlert/js/beAlert.js"></script>
	<script type="text/javascript"	src="__RESOURCE__/recouse/js/jquery.lazyload.min.js"></script>
	<script type="text/javascript">
		var openid_val = "<!--@php echo $openid; @-->";
		$(function(){
			var tab_index = 0;
			$(".integral-tab-ul li").on("click",function(){
				tab_index = $(this).index();
				$(".integral-tab-ul li").removeClass("li-active");
				$(this).addClass("li-active");
				$(".integral .tab-div").eq(tab_index).show().siblings(".tab-div").hide();
				if( tab_index==1 ){
					$("img.lazy").lazyload();//因为一开始图片被display:none设置了无法触发懒加载，所以主动触发
				}
			});
			$("img.lazy").lazyload({
				placeholder : "__RESOURCE__/recouse/images/ajax-loader.gif", // 占位图
				threshold : 200, //控制灵敏度
				effect : "fadeIn"
			});
		});
		//激 活
		function activation(){
			var phone_number = $(".phone-number").val();
			var order_number = $(".order-number").val();
			if (!order_number) {
				alert('请输入您的订单编号！');
				return false;
			}
			if (!phone_number) {
				alert('请输入您的手机号码！');
				return false;
			}
			if (phone_number.search(/^([0-9]{11})?$/) == -1) {
				alert('请输入正确的手机号码！');
				return false;
			}
			$.post("",{order:order_number,phone:phone_number},function(data){

			},"json");
		}
		//物流查询
		function search(){
			var logistics_val = $(".logistics").val();
			var logistics_select = $(".logistics-select").val();
			var express_src = $(".logistics-select option:checked").attr("data-url");
			if(!logistics_val){
				alert('请输入您的快递单号！');
				return false;
			}
			if($(".logistics-select option:checked").attr("class")=="tiantian"){
				$(".logistics-select option:checked").attr("data-url")+logistics_val;
			}
			$("#express").attr("src",express_src).show();
		}
		//立即兑换商品
		function exchange(productid,need_jifen){
			var hasAddress = $(".address_xinxi").length;
			if( !openid_val){
				confirm('您还没登录！','',function(isconfirm){
					if(isconfirm){
						var url = "<!--@php echo mobile_url('login'); @-->";
						window.location.href = url;
					}
				},{confirmButtonText: '立即登录', cancelButtonText: '稍后登录', width: 330});
				return '';
			}
			if( hasAddress==0 ){
				alert('请添加收货地址');
			}else{
				var jifen = $(".integral-number span").html();
				jifen = parseInt(jifen);
				if(jifen < need_jifen){
					alert("您的积分不足以兑换","当前此礼品所需积分为"+need_jifen);
					return '';
				}
				confirm('确认兑换该商品？','',function(isconfirm){
					if(isconfirm){
						var url ="<!--@php echo mobile_url('integral',array('op'=>'change'));@-->";
						$.post(url,{id:productid},function(data){
							if( data.errno == 200 ) {
								var msg = data.message;
								alert(msg.tit, msg.des, '', {type: 'success'});
								$(".integral-number span").html(jifen-need_jifen);
								$(".progress-detail span").html(jifen-need_jifen);
							}else{
								alert(data.message);
							}
						},"json");
					}
				},{confirmButtonText: '确认兑换', cancelButtonText: '稍后兑换', width: 330});
			}
		}
		
	</script>
	<!--@php if($_GP['mark'] == 'address'){ @-->
		<script>
			$(".integral-tab-ul li").removeClass("li-active");
			$(".integral-tab-ul li").eq(1).addClass("li-active");
			$(".integral .tab-div").eq(1).show().siblings(".tab-div").hide();
		</script>
	<!--@php } @-->	
	<!--@php include themePage('footer');@-->
</body>
</html>