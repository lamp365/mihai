<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>添加我的天猫订单</title>
		<link rel="shortcut icon" href="favicon.ico"/>
		<link type="text/css" rel="stylesheet" href="__RESOURCE__/mobile/style/style.css">
		<link rel="stylesheet" type="text/css" href="__RESOURCE__/recouse/css/add_order.css"/>
		<link type="text/css" rel="stylesheet" href="<?php echo RESOURCE_ROOT;?>addons/common/beAlert/css/BeAlert.css" />
	    <script type="text/javascript"src="__RESOURCE__/recouse/js/jquery-1.10.2.min.js"></script>
	    <script type="text/javascript" src="<?php echo RESOURCE_ROOT;?>addons/common/beAlert/js/beAlert.js"></script>
	</head>
	<body>
		<!--顶部返回栏-->
		<div class="cart_title">
		   <span class="return" style="line-height: 45px;">
		   		<img src="__RESOURCE__/openshop/images/return.png" width="10px" height="16px" style="vertical-align: middle;">
		   </span> 
		   <div class="title_center">
		  		  添加我的天猫订单
		    </div>
		</div>
		
		<div class="add_tm_order">
			<p>请输入你在天猫平台下单时，收货人的手机号码</p>
			<form  role="form" method="post">
				<input type="number" name="mobile" id="mobile" value="" placeholder="请输入手机号码"/>
				<input type="number" name="code" id="code" value="" placeholder="请输入短信验证码"/>
				<span onclick="sendsms(this)">发送验证码</span>
				<input type="button" name="add_order" id="add_order" value="关联天猫订单" onclick="checkInfo()"/>
			</form>
		</div>
		
	<script>
		
		$(".return").click(function(){
		    window.history.back(-1);
		})
		
		function checkInfo(){
			var mobile = $("#mobile").val();
			var code   = $("#code").val();
			var reg = /^0?1[3|4|5|8][0-9]\d{8}$/;				
			if(!mobile){
				alert("请输入手机号！");
				return false;
			}else if(!reg.test(mobile)) {
				alert('请输入正确的手机号码！');
				return false;
			}else if(!code){		
				alert("请输入验证码！");				
				return false;
			}else{
				var url = "<!--@php echo mobile_url('miyou',array('op'=>'add_tm_order')); @-->";
				$.post(url,{'code':code,'phone':mobile,'add_order':'1'},function(data){
					alert(data.message);
					if(data.errno == 200){
						setTimeout(function(){
							var reurl = "<!--@php echo mobile_url('miyou',array('op'=>'choose_order')); @-->";
							window.location.href = reurl;
						},2000);

					}
				},'json')
			}
		}	
		//发送验证码
    	function sendsms(obj) {    		
    		//获取手机号
			var	mobile = $("#mobile").val();
			if(mobile == ''){
				alert("对不起，手机号不能为空！");
				return '';
			}
			if(mobile.length != 11){
				alert("对不起，手机号格式不对");
				return '';
			}
			var bodyparam = {
				phone : mobile
			};
			var url = "<!--@php echo mobile_url('miyou',array('op'=>'add_tm_order'));@-->";
			$.post(url, bodyparam, function(data) {
				if(data.errno == 200){
					//调用发送验证码的方法
					settime(obj);
				}else{
					alert(data.message);
				}

			},'json');
		}
    	
    	//验证码倒计时
	    var countdown = 120;
		function settime(obj) {				
			if (countdown == 0) {
				obj.removeAttribute("disabled");
				$(obj).text("获取验证码");
				countdown = 120;
				return;
			} else {
				obj.setAttribute("disabled", true);
				$(obj).text("重新发送(" + countdown + ")");
				countdown--;
			}
			setTimeout(function() {
				settime(obj)
			}, 1000)
		}
		
		</script>
		<!--@php  include themePage('footer');@-->