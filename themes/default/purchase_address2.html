<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>收货地址</title>
		<meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<script type="text/javascript"	src="__RESOURCE__/recouse/js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="__RESOURCE__/script/jquery-1.7.2.min.js"></script>
		<script type="text/javascript" src="__RESOURCE__/script/common.js"></script>
		<link type="text/css" rel="stylesheet" href="__RESOURCE__/mobile/style/bootstrap.css">
		<script type="text/javascript" src="__RESOURCE__/script/bootstrap.js"></script>
		<script type="text/javascript" src="__RESOURCE__/script/angular.min.js"></script>
		<link type="text/css" rel="stylesheet" href="__RESOURCE__/recouse/css/font-awesome.min.css" />
		<link type="text/css" rel="stylesheet" href="__RESOURCE__/mobile/style/common.mobile.css">
		<link type="text/css" rel="stylesheet" href="__RESOURCE__/mobile/style/style.css">
		<link href="__RESOURCE__/recouse/css/bjcommon.css" rel="stylesheet" type="text/css" /> 
		<script type="text/javascript" src="__RESOURCE__/script/cascade.js"></script>
		<script type="text/javascript" src="__RESOURCE__/mobile/script/jquery.touchwipe.js"></script>
		<script type="text/javascript" src="__RESOURCE__/mobile/script/swipe.js"></script>
		<style type='text/css'>
			#poptip {
				position: fixed;
				top: 40%;
				left: 50%;
				width: 160px;
				margin-left: -80px;
				height: 27px;
				background: #000;
				opacity: 0.7;
				filter: alpha(opacity=0.7);
				color: #fff;
				z-index: 999;
				border-radius: 5px;
				-webkit-border-radius: 5px;
				-moz-border-radius: 5px;
			}
			
			#poptip_content {
				position: fixed;
				top: 40%;
				left: 50%;
				width: 160px;
				margin-left: -80px;
				height: 27px;
				color: #fff;
				text-align: center;
				font-size: 14px;
				z-index: 9909
			}

			select,
			textarea,
			input[type="text"],
			input[type="password"],
			input[type="datetime"],
			input[type="datetime-local"],
			input[type="date"],
			input[type="month"],
			input[type="time"],
			input[type="week"],
			input[type="number"],
			input[type="email"],
			input[type="url"],
			input[type="search"],
			input[type="tel"],
			input[type="color"],
			.uneditable-input {
				width: 100%;
				margin-bottom: 0;
				box-sizing: border-box;
				-webkit-box-sizing: border-box;
				-moz-box-sizing: border-box;
			}
			
			input[type="text"],
			input[type="password"],
			input[type="datetime"],
			input[type="datetime-local"],
			input[type="date"],
			input[type="month"],
			input[type="time"],
			input[type="week"],
			input[type="number"],
			input[type="email"],
			input[type="url"],
			input[type="search"],
			input[type="tel"],
			input[type="color"],
			.uneditable-input {
				height: 30px;
			}
			select {
			  border: solid 1px #000;
			  /*将默认的select选择框样式清除*/
			  appearance:none;
			  -moz-appearance:none;
			  -webkit-appearance:none;
			  /*为下拉小箭头留出一点位置，避免被文字覆盖*/
			  padding-right: 14px;
			}
			.input-append,
			.input-prepend {
				width: 100%;
				margin-bottom: 0;
			}
			
			select {
				padding: 0 5px;
				line-height: 28px;
				-webkit-appearance: button;
			}
			
			.checkbox.inline {
				margin-top: 0;
			}
			
			.checkbox.inline+ .checkbox.inline {
				margin-left: 0;
			}
			
			.checkbox input[type="checkbox"] {
				filter: alpha(opacity: 0);
				opacity: 0;
			}
			
			.file {
				position: relative;
			}
			
			.file input[type="file"] {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				filter: alpha(opacity: 0);
				opacity: 0;
			}
			
			.file button {
				width: 100%;
				text-align: left;
			}
			
			.form-item {
				border-left: 3px #ED2F2F solid;
				padding-left: 10px;
				height: 30px;
				line-height: 30px;
				background: #F7F7F7;
				margin-bottom: 10px;
			}
			.btn{
                width:150px;
				margin-right:20px;
			}
			.add-address{
				width: 850px;
				height: 370px;
				
			}
			.col-sm-3 {
				width: 185px;
				text-align: right;
				float: left;
			}
			.col-sm-9{
				width: 645px;
				display: inline-block;
			}
			.col-sm-12{
				padding-left: 200px;
			}
		</style>
		<script language='javascript'>
			function tip(msg, autoClose) {
				var div = $("#poptip");
				var content = $("#poptip_content");
				if(div.length <= 0) {
					div = $("<div id='poptip'></div>").appendTo(document.body);
					content = $("<div id='poptip_content'>" + msg + "</div>").appendTo(document.body);
				} else {
					content.html(msg);
					content.show();
					div.show();
				}
				if(autoClose) {
					setTimeout(function() {
						content.fadeOut(500);
						div.fadeOut(500);

					}, 1000);
				}
			}

			function tip_close() {
				$("#poptip").fadeOut(500);
				$("#poptip_content").fadeOut(500);
			}
		</script>
	</head>

	<body>	
			<form class="form-horizontal" method="post" action="<!--@php  echo mobile_url('address')@-->" role="form" style="width: 850px;margin: 25px;">
				<input type="hidden" name="goodstype" value="<!--@php  echo $goodstype;@-->" />
				<div class="order-main" style="border: none;">									
					<!--这里开始是添加收获地址的页面-->	
					<h1 style="font-size: 20px;color:#999;padding:10px;border-bottom: dashed 1px gainsboro;margin-bottom: 40px;"><!--@php if ( isset($_GP['id'])) { echo '修改'; } else { echo '新增';} @-->收货地址</h1>
					<div class="add-address img-rounded" id="addAddressPanel">
						<div class="add-address-main"style="border: none;">
							<div class="form-group">
								<label for="" class="col-sm-3 control-label"><font color="red">*</font> 收货人：</label>
								<div class="col-sm-9">
									<input type="text" class="form-control" id="realname">
								</div>
							</div>
							<div class="form-group">
								<label for="" class="col-sm-3 control-label"><font color="red">*</font> 联系电话：</label>
								<div class="col-sm-9">
									<input type="text" class="form-control" id="mobile">
								</div>
							</div>
							<div class="form-group">
								<label for="" class="col-sm-3 control-label"><font color="red">*</font> 地区：</label>
								<div class="col-sm-9">
									<select id="sel-provance" onChange="selectCity();" class="pull-left form-control" style="width:30%; margin-right:5%;">
										<option value="" selected="true">省/直辖市</option>
									</select>
									<select id="sel-city" onChange="selectcounty()" class="pull-left form-control" style="width:30%; margin-right:5%;">
										<option value="" selected="true">请选择</option>
									</select>
									<select id="sel-area" class="pull-left form-control" style="width:30%;">
										<option value="" selected="true">请选择</option>
									</select>
								</div>
							</div>
							<div class="form-group">
								<label for="" class="col-sm-3 control-label"><font color="red">*</font> 详细地址：</label>
								<div class="col-sm-9">
									<input type="text" class="form-control" id="address">
								</div>
							</div>

							<input type="hidden" id="addressid" value="" />
							<div class="form-group">
								<div class="col-sm-12">
								    <button type="button" class="btn" onclick="addAddress();$('.address',parent.document).hide(); $('.iDialogLayout',parent.document).hide();">取消</button>
									<button type="button" class="btn btn-danger" onclick="saveAddress()" id="saveadress">保存</button>	
								</div>
							</div>
						</div>						
					</div>					
				</div>
			</form>
				<script src="__RESOURCE__/recouse/js/zepto.min.js" type="text/javascript"></script>
				<script type="text/javascript">
					function get_search_box() {
						try {
							document.getElementById('get_search_box').click();
						} catch(err) {
							document.getElementById('keywordfoot').focus();
						}
					}
				</script>

				<script type="text/javascript" src="__RESOURCE__/recouse/js/cascade.js?x=14"></script>
				<script type="text/javascript">
					var from = '<!--@php  echo $from;@-->';
					var returnurl = '<!--@php  echo $returnurl;@-->';
					cascdeInit('__RESOURCE__/recouse/js', '', '', '');

	function saveAddress() {
		
		var realname = $('#realname').val();
		var mobile = $('#mobile').val();
		var province = $('#sel-provance').val();
		var city = $('#sel-city').val();
		var idname = $('#idname').val();
		var idnumber = $('#idnumber').val();
		var area = $('#sel-area').val();
		if(area == null) {
			area = '';
		}
		if(city == null) {
			city = '';
		}
		if(province == null) {
			province = '';
		}
		var address = $('#address').val();

		if(!realname) {
			alert('请输入您的真实姓名！');
			return false;
		}
		if(!mobile) {
			alert('请输入您的手机号码！');
			return false;
		}
		if(mobile.search(/^([0-9]{11})?$/) == -1) {
			alert('请输入正确的手机号码！');
			return false;
		}
		if(!address) {
			alert('请输入您的详细地址！');
			return false;
		}
		$.post("<!--@php  echo mobile_url('purchase_address')@-->", {
				'op': 'post',
				'realname': realname,
				'mobile': mobile,
				'province': province,
				'city': city,
				'area': area,
				'ajax':'ajax',
				'address': address,
				'id': $('#addressid').val()
			},
			function(s) {
				if(s.errno == 200 ) {
				     var addresslist = $("#addresslist", parent.document); 
					 var id = $('#addressid').val()?$('#addressid').val():s.message;
					 var url = '<!--@php  echo mobile_url("purchase_address",array("op"=>"ajax"))@-->'
				     var newaddress = '<div class="addr-bd"><strong style="float: left;">'+realname+' 收</strong><span class="set" onclick="setdefault('+id+')">默认地址</span></div><div class="addr-hd"> '+province +' '+ city + ' ' + area+' ' + address + ' '+mobile+'</div>';
					 newaddress = newaddress + '<div class="dosg"><span class="edit" onclick="openDialog(\''+url+"&id="+id+'\')">修改</span><span class="del" onclick="addressDel('+id+')">删除</span></div><div class="choose"></div>';
					 if ($('#addressid').val() != ''){
					     $(".address_"+$('#addressid').val(), parent.document).html(newaddress);
					 }else{
					     newaddress = '<div class="address_item address_'+id+'" address_id='+id+' onclick="setaddress('+id+')">' + newaddress + '</div>';
                         addresslist.prepend(newaddress);
						 $(".this_address",parent.document).removeClass("this_address");
		                 $(".address_"+id,parent.document).addClass("this_address");
                         $("#addressval",parent.document).val(id);
                     }
                     $(".address",parent.document).hide();
	                 $(".iDialogLayout",parent.document).hide();
				} else {
					 alert(s.message);
				}
			}, 'json');
	}
    function openDialog(){
	}
	function addressDel(){
	}
	function addAddress() {
		$('#addAddressPanel').show();
		$("#addressBtn").hide();
		$('#realname').val('');
		$('#mobile').val('');
		$('#address').val('');
		cascdeInit('__RESOURCE__/recouse/js', '', '', '');
		$('#addressid').val('');

	}
function saveDefaultAddress(e,id) {
	$.post('<!--@php  echo mobile_url('purchase_address', array('op' => 'default'))@-->', {
		'id' : id,
	   }, function(s) {
	   	
		//$("input [name='address']").attr('checked', false);
        $(".address_item").removeClass("shopcart-main1").addClass("shopcart-main");
		$("#address_"+id).addClass("shopcart-main1");
	    }, 'json');
        e.stopPropagation() ;
}
function removeAddress(e,id){
    if(confirm('确认要删除此收货地址吗?')){
	$.post('<!--@php  echo mobile_url('purchase_address', array('op' => 'remove'))@-->', {
		'id' : id,
	}, function(s) {
                            
	         $("#address_"+id).remove();
                           if(s.maxid!='0'){
                                 $(".address_item").removeClass("shopcart-main1").addClass("shopcart-main");
		$("#address_"+s.maxid).addClass("shopcart-main1");
                            }
	}, 'json');
          e.stopPropagation() ;
    }
}

		var isdef = 0;
function editAddress(id) {
	$("#addressBtn").hide();
       if (from=='confirm'){
               //  location.href = '<!--@php  echo mobile_url('confirm')@-->';
	$.post('<!--@php  echo mobile_url('purchase_address', array('op' => 'default'))@-->', {
		'id' : id,
	}, function(s) {
            if(returnurl!=''){
                location.href = returnurl;
                return;
            }
            location.href = '<!--@php  echo mobile_url('confirm')@-->';
        });
        return;
       }
                                        
	$.get('<!--@php  echo mobile_url('purchase_address', array('op' => 'detail'))@-->', {
		'id' : id,
	}, function(s){
		if (s.message) {
			$('#addAddressPanel').show();
			$('#realname').val(s.message.realname);
			$('#mobile').val(s.message.mobile);
			$('#address').val(s.message.address);
			cascdeInit('__RESOURCE__/recouse/js',s.message.province,s.message.city,s.message.area);
			$('#addressid').val(s.message.id);
		}
	}, 'json');    
}

$(document).ready(function(){
	var id = <!--@php echo isset($_GP['id'])?$_GP['id']:-1; @-->;
	if ( id != '' ){
		editAddress(id);
	}
});
</script>
</body>
</html>