<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>身份证管理</title>
		<meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<script type="text/javascript" src="__RESOURCE__/recouse/js/jquery-1.11.0.js" charset="utf-8"></script>
		<!---->
		<script src="__RESOURCE__/recouse/js/webuploader/webuploader.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="__RESOURCE__/script/common.js"></script>
		<link type="text/css" rel="stylesheet" href="__RESOURCE__/mobile/style/bootstrap.css">
		<script type="text/javascript" src="__RESOURCE__/script/bootstrap.js"></script>
		<script type="text/javascript" src="__RESOURCE__/script/angular.min.js"></script>
		<link type="text/css" rel="stylesheet" href="__RESOURCE__/recouse/css/font-awesome.min.css" />
		<link type="text/css" rel="stylesheet" href="__RESOURCE__/mobile/style/style.css">
		<link type="text/css" rel="stylesheet" href="__RESOURCE__/recouse/css/identity.css">
		<link href="__RESOURCE__/recouse/css/bjcommon.css" rel="stylesheet" type="text/css" />
		<link rel="shortcut icon" href="favicon.ico" />
		<!---->
		<link rel="stylesheet" type="text/css" href="__RESOURCE__/recouse/js/webuploader/webuploader.css" />
	</head>
	<style type="text/css">
		.m-question {
			font-size: 12px;
		}
		
		.m-question .answer {
			padding-left: 20px;
			margin-bottom: 20px;
		}
		
		.m-question .question {
			margin-bottom: 5px;
		}
		
		.form-control {
			width: 685px\9;
			+height: 20px;
		}
		
		.col-sm-9 {
			display: inline-block;
		}
		
		.col-sm-9 {
			*display: inline;
		}
		
		.control-label {
			width: 217px\9;
			+height: 21px;
			text-align: right;
			vertical-align: middle;
		}
		
		.erweima {
			display: inline-block;
			margin-left: 30px;
			font-size: 14px;
			text-align: center;
		}
		
		.erweima {
			*display: inline\9;
		}
		
		.chooseImg {
			position: absolute;
		}
		
		.indentityImg img {
			width: 198px;
			height: 120px;
		}
		
		.indentityImg {
			position: relative;
		}
		
		.toast {
			width: 100px;
			display: none;
			margin-left: 50px;
			height: 40px;
			background-color: #CDCDD7;
			box-shadow: 0 1px 10px rgba(0, 0, 0, 0.7);
			color: #fff;
			position: fixed;
			top: 258px;
			z-index: 100000;
			border-radius: 2px;
			text-align: center;
			line-height: 40px;
		}
		
		.uploader-list {
			height: 120px;
			width: 200px;
			border: solid 1px gainsboro;
			position: relative;
			background: #f8f8f8;
		}
		
		.uploader-list h3 {
			transform: rotate(-25deg);
			font-size: 26px;
			font-weight: bold;
			color: #A1A1A1;
			position: absolute;
			top: 35px;
			left: 25px;
			z-index: 100;
			display: none;
		}
		
		.uploader-list .reUploader {
			margin-top: 96px;
			width: 100%;
			height: 24px;
			text-align: center;
			line-height: 24px;
			background: #000;
			opacity: 0.5;
			filter: progid:DXImageTransform.Microsoft.Alpha(opacity=70);
			color: #fff;
			margin-left: 0px;
			cursor: pointer;
			display: none;
			position: absolute;
			z-index: 100;
		}
		.reUploader .webuploader-pick{
			height: 24px;
			line-height:24px;
			opacity: 0.7;
			filter: progid:DXImageTransform.Microsoft.Alpha(opacity=70);
			margin-left: -102px;
			margin-left: 0px\0;
			position: absolute;
			text-align: center;
			
		}
	</style>

	<body>
		<!--@php  include page('header');@-->
		<div class="viewport">
			<div class="crumbs">
				<span>当前位置：</span>
				<a href="<?php  echo mobile_url('fansindex',array('name'=>'shopwap')); ?>">个人中心</a>&gt;
				<strong>我的清关材料</strong>
			</div>
			<div class="r-member">
				<div class="personalTitle pT">
					我的清关材料
				</div>
				<!--@php  if(is_array($arrIdentity) && !empty($arrIdentity)) { @-->
				<div style="display:block;margin-bottom: 30px;">
					<table width="100%" border="0" cellpadding="0" cellspacing="0" class="acticle-infor">
						<tbody>
							<tr>
								<th>身份证姓名</th>
								<th>身份证号码</th>
								<th>证件照片</th>
								<th>操作</th>
								<th>状态</th>
							</tr>

							<!--@php foreach($arrIdentity as $row) { @-->
							<tr>
								<td>
									<!--@php  echo $row['identity_name'];@-->
								</td>
								<td>
									<!--@php  echo $row['identity_number'];@-->
								</td>
								<td>
									<!--@php  if(!empty($row['identity_front_image'])) { @-->
									<img src="<!--@php  echo $row['identity_front_image'];@-->" height="32" width="46">
									<!--@php  } @-->

									<!--@php  if(!empty($row['identity_back_image'])) { @-->
									<img src="<!--@php  echo $row['identity_back_image'];@-->" height="32" width="46">
									<!--@php  } @-->
								</td>
								<td>
									<a href="<!--@php  echo mobile_url('identity', array('op' => 'edit','identity_id'=>$row['identity_id']))@-->">修改</a>
									<a href="<!--@php  echo mobile_url('identity', array('op' => 'remove','identity_id'=>$row['identity_id']))@-->">删除</a>
								</td>
								<td><!--@php if ( $row['isdefault'] == 1 ) { echo '默认'; }else{ echo '<a href="'.mobile_url('identity', array('op' => 'default','identity_id'=>$row['identity_id'])).'">设为默认</a>'; }  @--></td>
							</tr>
							<!--@php  } @-->
						</tbody>
					</table>

				</div>
				<!--@php  } @-->
				<div class="order-main" id="addIdentityPanel" style="border-bottom: solid 1px gainsboro;display:<!--@php echo empty($arrIdentity) || !empty($identity)?'block':'none' @-->;">
					<form class="form-horizontal" id="J_identityForm" method="post" autocomplete="off" enctype="multipart/form-data" style="border: none;">
						<input type="hidden" name="op" value="<!--@php  if(!empty($_GET['identity_id']) && $_GET['op']=='edit') {echo 'update';}else{echo 'insert';} @-->" />
						<input type="hidden" name="identity_id" value="<!--@php echo (int)$_GET['identity_id']; @-->" />
						<div style="padding: 10px;border-bottom: solid 1px gainsboro;width: 100%;+width:1000px;background: #FFF8DB;">
							<img src="__RESOURCE__/recouse/images/laba.png" style="width: 25px;height: 25px;" />
							<p style="font-weight: bold;color: black;display: inline-block;">根据海关规定，购买跨境商品需要办理清关手续，请您配合进行实名认证，以确保您购买的商品顺利通过海关检查。</p>
							<p style="color: red;padding-left: 27px;">（觅海全球购承诺所传身份证明只用于办理跨境商品的清关手续，不作他途使用，其他任何人均无法查看。）</p>
							<p style="font-weight: bold;color: black;padding-left: 25px;font-size: 12px;margin: 5px;">实名认证的规则：</p>
							<p style="color: black;padding-left: 30px;font-size: 12px;">购买跨境商品需填写觅海账号注册人的真实姓名及身份证号码，部分商品下单时需提供收货人的实名信息（含身份证照片），具体请以下单时的提示为准。</p>
						</div>
						<div class="add-address img-rounded" id="addAddressPanel" <!--@php if(!empty($address)) { @--> style="display:none;"
							<!--@php  } @-->>
							<div class="add-address-hd">请仔细填写身份证信息：</div>
							<div class="add-address-main" style="border-bottom: none;">
								<div class="form-group">
									<label for="" class="col-sm-3 control-label" style="+margin-top: -20px;">身份证姓名：</label>
									<div class="col-sm-9">
										<input type="text" class="form-control" id="J_identity_name" name="identity_name" value="<!--@php  echo $identity['identity_name'];@-->" placeholder="请填写您的真实姓名">
									</div>
								</div>
								<div class="form-group">
									<label for="" class="col-sm-3 control-label" style="*margin-top: -20px;">身份证号码：</label>
									<div class="col-sm-9">
										<input type="text" class="form-control" id="J_identity_number" name="identity_number" value="<!--@php  echo $identity['identity_number'];@-->" placeholder="请填写姓名所对应的身份证号">
									</div>
								</div>
								<div class="form-group">

									<label for="" class="col-sm-3 control-label" style="float: left;+padding-left: 0px;"> 证件照片：</label>
									<div class="col-sm-9">
										<div style="height: 190px;display: none;">
											<!--添加正面身份证照片-->
											<!--@php  if(!empty($identity['identity_front_image'])) { @-->
											<img src="<!--@php  echo $identity['identity_front_image'];@-->" height="135" width="226">
											<!--@php  } @-->
											<div style="height: 120px;width:200px;border: solid 1px gainsboro;text-align: center;float: left;">
												<input id="J_uploadFrontImage" type="file" name="front_image" style="height: 120px;width: 231px;opacity: 0;filter:Alpha(Opacity=0);cursor: pointer;">
												<span style="position: absolute;top:50px;left: 80px;cursor:pointer;" onclick="addfrontimg()">+添加正面</span> 示例：
												<br />
												<img src="__RESOURCE__/recouse/images/face.png" />
											</div>
											<!--添加反面-->
											<!--@php  if(!empty($identity['identity_back_image'])) { @-->
											<img src="<!--@php  echo $identity['identity_back_image'];@-->" height="135" width="226">
											<!--@php  } @-->
											<div style="height: 120px;width:200px;border: solid 1px gainsboro;text-align: center;display: inline-block;float: left;margin-left: 30px;">
												<input id="J_uploadBackImage" type="file" name="back_image" style="height: 120px;width: 198px;opacity: 0;filter:Alpha(Opacity=0);cursor:pointer">
												<span style="position: absolute;top:50px;left: 320px;cursor: pointer;" onclick="addbackimg()">+添加反面</span> 示例：
												<br />
												<img src="__RESOURCE__/recouse/images/back.png" />
											</div>
										</div>

										<!--web uploader在这里！！！！！！！-->
										<!--添加正面-->
										<div style="float: left;">
											<div id="fileList1" class="uploader-list">
												<div class="toast1 toast"></div>
												<div id="filePicker1" class="chooseImg">+添加正面</div>
												<span class="reUploader" id="reloaderFront">重新上传</span>
												<input type="hidden" name="identity_front_image" value="<!--@php echo !empty($identity['identity_front_image'])?$identity['identity_front_image']:'' @-->" id="front" />
												<h3>仅做清关用途</h3>

												<!--用于放已经上传过的图片，点击修改按钮时出现-->
												<!--@php  if(!empty($identity['identity_front_image'])) { @-->
												<div style="width: 200px;height: 120px;position: absolute;" id="oldFrontimg">
													<img src="<!--@php  echo $identity['identity_front_image'];@-->" style="width: 198px;height: 120px;" />
													<span class="reUploader" id="oldrefront" style="display: block;margin-top: -24px;width: 198px;">重新上传</span>
													<h3 style="display: block;">仅做清关用途</h3>
												</div>
												<!--@php  } @-->
											</div>
											<div style="text-align: center;margin-top: 5px;">
												示例：<br />
												<img src="__RESOURCE__/recouse/images/face.png" />
											</div>
										</div>
										<!--添加反面-->
										<div style="float: left;margin-left: 50px;">
											<div id="fileList2" class="uploader-list">
												<div class="toast2 toast"></div>
												<div id="filePicker2" class="chooseImg">+添加反面</div>
												<span class="reUploader" id="reloaderBack" ></span>
												<input type="hidden" name="identity_back_image" value="<!--@php echo !empty($identity['identity_back_image'])?$identity['identity_back_image']:'' @-->" id="back" />
												<h3>仅做清关用途</h3>

												<!--用于放已经上传过的图片，点击修改按钮时出现-->
												<!--@php  if(!empty($identity['identity_back_image'])) { @-->
												<div style="width: 200px;height: 120px;position: absolute;" id="oldBackimg">
													<img src="<!--@php  echo $identity['identity_back_image'];@-->" style="width: 198px;height: 120px;" />
													<span class="reUploader" id="oldreback" style="display: block;margin-top: -24px;width: 198px;"></span>
													<h3 style="display: block;">仅做清关用途</h3>
												</div>
												<!--@php  } @-->
											</div>
											<div style="text-align: center;margin-top: 5px;">
												示例：<br />
												<img src="__RESOURCE__/recouse/images/back.png" />
											</div>
										</div>

										<!--扫描二维码-->
										<div class="erweima">
											<img src="__RESOURCE__/recouse/images/weixin.jpg" style="width: 80px;height: 80px;"/>
											<p>上传照片太麻烦？</p>
											<p>直接扫码微信端认证吧！</p>
										</div>
										<div style="clear: both;"></div>
										<div style="color:rgb(153,153,153);margin-top: 10px;">
											注：</br>
											1、支持JPG、JPEG、GIF和PNG格式，单张图片大小不超过5M<br /> 2、需上传清晰的身份证正、反面，共两张照片
										</div>
									</div>
								</div>

								<input type="hidden" id="addressid" value="" />
								<div class="form-group">
									<div class="col-sm-12" style="text-align: center;">
										<button type="button" class="btn btn-danger" onclick="saveIdentity();" style="margin-right: 20px;">保存</button>
										<button type="button" class="btn" onclick="window.location.href='<!--@php echo mobile_url('identity')@-->'">取消</button>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
				<!--@php  if(!empty($arrIdentity)) { @-->
				<div>
					<button type="button" class="btn btn-danger" id="IndentityBtn" onclick="addIdentity()" style="margin: 20px 0;float: right;display:<!--@php echo empty($identity)?'block':'none' @-->">
					<i class="icon-plus"></i> 添加清关材料
				</button>
				</div>
				<!--@php  } @-->
				<div style="height: 50px;"></div>

				<div class="usuallyQuestion">
					<div class="personalTitle pT">
						常见问题
					</div>
					<div class="m-question">
						<p class="question">1、为什么要进行实名认证？</p>
						<p class="answer">根据海关规定，购买跨境商品需进行实名认证，用于个人物品入境申报。为确保您购买的商品能够顺利办理清关手续，请配合提供实名信息，否则将无法正常发货哦！</p>
						<p class="question">2、实名认证必须要上传身份证照片吗？</p>
						<p class="answer">根据海关要求，部分跨境商品清关时需提供收货人实名信息对身份证影印件进行校验，具体请以下单时提示为准。觅海会对您的个人信息做加密处理，不作他途使用，其他任何人均无法查看。</p>
						<p class="question">3、账户默认实名人是什么意思？</p>
						<p class="answer">
							除部分需进行收货人实名的商品外，购买其他跨境商品时觅海将自动提供您“账户默认实名人”的实名信息给到海关做入境申报。海关将会将此笔订单的商品金额计入到该实名信息的个人年度交易20000元限额内。
						</p>
						<p class="question">4、海关20000元限额具体规则是什么？</p>
						<p class="answer">根据《关于跨境电子商务零售进口税收政策的通知》，跨境电子商务零售进口商品的单次交易限值为人民币2000元，个人年度交易限值为人民币20000元。个人年度交易限额指您在全网各跨境平台购买的所有跨境商品在全年内累计金额不能超过20000元，超过限额海关有权进行退单处理。</p>
					</div>
				</div>
			</div>
			<div class="l-member">
				<!--@php include themePage('leftmenu');@-->
			</div>
		</div>
		<!--@php include themePage('footer');@-->

		<script type="text/javascript">
			//上传正面		
			function uploaderfrontImg() {
				// 初始化Web Uploader
				var $ = jQuery,
					$list = $('#fileList1'),
					// 优化retina, 在retina下这个值是2
					ratio = window.devicePixelRatio || 1,

					// 缩略图大小
					thumbnailWidth = 100 * ratio,
					thumbnailHeight = 100 * ratio,

					// Web Uploader实例
					uploader;
				var uploader = WebUploader.create({

					// 选完文件后，是否自动上传。
					auto: true,

					swf: '__RESOURCE__/recouse/js/webuploader/Uploader.swf',

					// 文件接收服务端。 请查看服务端文件可以七牛可以本地
					server: "fileupload.php?dir=identy",

					// 选择文件的按钮。可选。
					// 内部根据当前运行是创建，可能是input元素，也可能是flash.

					pick: '#filePicker1',

					//可以重复上传
					duplicate: true,

					// 只允许选择图片文件。
					accept: {
						title: 'Images',
						extensions: 'gif,jpg,jpeg,bmp,png',
						mimeTypes: 'image/jpg,image/jpeg,image/png'
					}

				});

				uploader.addButton({
					id: '#reloaderFront',
					innerHTML: '重新上传'
				});
				uploader.addButton({
					id: '#oldrefront',
					innerHTML: '重新上传'
				});
					// 当有文件添加进来的时候
				uploader.on('fileQueued', function(file) {
					$("#fileList1 .indentityImg").remove();
					$("#fileList1 h3").hide();
					//隐藏添加照片的文字
					var $li = $(
							'<div id="' + file.id + '" class="indentityImg">' +
							'<img>' +
							'</div>'
						),
						$img = $li.find('img');
					// $list为容器jQuery实例
					$list.append($li);

					// 创建缩略图
					// 如果为非图片文件，可以不用调用此方法。
					// thumbnailWidth x thumbnailHeight 为 100 x 100
					uploader.makeThumb(file, function(error, src) {
						if(error) {
							$img.replaceWith('<span>不能预览</span>');
							return;
						}

						$img.attr('src', src);
					}, thumbnailWidth, thumbnailHeight);
				});

				// 文件上传过程中创建进度条实时显示。
				uploader.on('uploadProgress', function(file, percentage) {
					var $li = $('#' + file.id),
						$percent = $li.find('.progress span');

					// 避免重复创建
					if(!$percent.length) {
						$percent = $('<p class="progress"><span></span></p>')
							.appendTo($li)
							.find('span');
					}

					$percent.css('width', percentage * 100 + '%');
				});

				// 文件上传成功，给item添加成功class, 用样式标记上传成功。
				uploader.on('uploadSuccess', function(file,response) {
					//$("#filePicker1").hide();	
					var data = eval("(" +response._raw+ ")");
					if(data.hasOwnProperty('error')){
						toast1("long", "上传失败");
					}else{
						$("#fileList1 h3").show();
						$("#front").val(data.name);
						$('#' + file.id).addClass('upload-state-done');
					}
				});

				// 文件上传失败，显示上传出错。
				uploader.on('uploadError', function(file) {
					toast1("long", "上传失败");
				});

				// 完成上传完了，成功或者失败，先删除进度条。
				uploader.on('uploadComplete', function(file) {
					$('#' + file.id).find('.progress').remove();
					$("#reloaderFront").show();
				});

			}

			//上传背面
			function uploaderbackImg() {
				// 初始化Web Uploader
				var $ = jQuery,
					$list2 = $('#fileList2'),
					// 优化retina, 在retina下这个值是2
					ratio = window.devicePixelRatio || 1,

					// 缩略图大小
					thumbnailWidth = 100 * ratio,
					thumbnailHeight = 100 * ratio,

					// Web Uploader实例
					uploader;
				var uploader = WebUploader.create({

					// 选完文件后，是否自动上传。
					auto: true,

					// swf文件路径
					swf: '__RESOURCE__/recouse/js/webuploader/Uploader.swf',

					// 文件接收服务端。 请查看服务端文件可以七牛可以本地
					server: "fileupload.php?dir=identy",

					// 选择文件的按钮。可选。
					// 内部根据当前运行是创建，可能是input元素，也可能是flash.
					pick: '#filePicker2',

					//可以重复上传
					duplicate: true,

					// 只允许选择图片文件。
					accept: {
						title: 'Images',
						extensions: 'gif,jpg,jpeg,bmp,png',
						mimeTypes: 'image/jpg,image/jpeg,image/png'
					}
				});
				
				uploader.addButton({
					id: '#reloaderBack',
					innerHTML: '重新上传'
				});
				//已经有验证信息图片时，点击重新上传
				uploader.addButton({
					id: '#oldreback',
					innerHTML: '重新上传'
				});
				// 当有文件添加进来的时候
				uploader.on('fileQueued', function(file) {
					$("#fileList2 .indentityImg").remove();
					$("#fileList2 h3").hide();
					var $li2 = $(
							'<div id="' + file.id + '" class="indentityImg">' +
							'<img>' +
							'</div>'
						),
						$img = $li2.find('img');

					// $list为容器jQuery实例
					$list2.append($li2);

					// 创建缩略图
					// 如果为非图片文件，可以不用调用此方法。
					// thumbnailWidth x thumbnailHeight 为 100 x 100
					uploader.makeThumb(file, function(error, src) {
						if(error) {
							$img.replaceWith('<span>不能预览</span>');
							return;
						}

						$img.attr('src', src);
					}, thumbnailWidth, thumbnailHeight);
				});

				// 文件上传过程中创建进度条实时显示。
				uploader.on('uploadProgress', function(file, percentage) {
					var $li = $('#' + file.id),
						$percent = $li.find('.progress span');

					// 避免重复创建
					if(!$percent.length) {
						$percent = $('<p class="progress"><span></span></p>')
							.appendTo($li)
							.find('span');
					}

					$percent.css('width', percentage * 100 + '%');
				});

				// 文件上传成功，给item添加成功class, 用样式标记上传成功。
				uploader.on('uploadSuccess', function(file, response) {
					//$("#filePicker2").hide();
					var data = eval("(" +response._raw+ ")");
					if(data.hasOwnProperty('error')){
						toast2("long", "上传失败");
					}else{
						$("#fileList2 h3").show();
						$("#back").val(data.name);
						$('#' + file.id).addClass('upload-state-done');
					}

				});

				// 文件上传失败，显示上传出错。
				uploader.on('uploadError', function(file) {
					toast2("long", "上传失败");
				});

				// 完成上传完了，成功或者失败，先删除进度条。
				uploader.on('uploadComplete', function(file) {
					$('#' + file.id).find('.progress').remove();
					$("#reloaderBack").show();
				});

			}

			//调用上传身份证方法
			$(document).ready(function() {
				uploaderfrontImg();
				uploaderbackImg();
			})

			

			var from = '<!--@php  echo $from;@-->';
			var returnurl = '<!--@php  echo $returnurl;@-->';
			cascdeInit('__RESOURCE__/recouse/js', '', '', '');

			//点击保存按钮
			function saveIdentity() {

				var identity_name = $.trim($('#J_identity_name').val());
				var identity_number = $.trim($('#J_identity_number').val());

				var address = $('#address').val();
				if(!identity_name) {
					alert('请输入您的身份证姓名！');
					return false;
				}
				if(!identity_number) {
					alert('请输入您的身份证号码！');
					return false;
				} else if(identity_number.length != 15 && identity_number.length != 18) {
					alert("输入身份证号码格式不正确!");
					return false;
				}

				$('#J_identityForm').submit();
				$("#addIdentityPanel").hide();
				$("#IndentityBtn").show();
				$(".usuallyQuestion").hide();
			}

			//点击添加修改认证按钮				
			function addIdentity() {
				$("#addIdentityPanel").show();
				$("#IndentityBtn").hide();
				$(".usuallyQuestion").show();
				//调用上传照片插件

			}
  
			function addfrontimg() {
				return $("#J_uploadFrontImage").click();
			}

			function addbackimg() {
				return $("#J_uploadBackImage").click();
			}

			//显示上传正面失败
			function toast1(type, str) {
				var time = 0;
				if(type == "short") {
					time = 1500;
				} else if(type == "long") {
					time = 2500;
				}
				$(".toast1").show();
				$(".toast1").html(str);
				setTimeout(function() {
					$(".toast1").hide();
				}, time);
			}

			//显示上传背面失败
			function toast2(type, str) {
				var time = 0;
				if(type == "short") {
					time = 1500;
				} else if(type == "long") {
					time = 2500;
				}
				$(".toast2").show();
				$(".toast2").html(str);
				setTimeout(function() {
					$(".toast2").hide();
				}, time);
			}
		</script>
		<!--@php  include page('footer');@-->