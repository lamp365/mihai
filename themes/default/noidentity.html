<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>付款成功</title>
		<meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<script type="text/javascript"	src="__RESOURCE__/recouse/js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="__RESOURCE__/script/jquery-1.7.2.min.js"></script>
		<script type="text/javascript" src="__RESOURCE__/script/common.js"></script>
		<link type="text/css" rel="stylesheet" href="__RESOURCE__/mobile/style/bootstrap.css">
		<script type="text/javascript" src="__RESOURCE__/script/bootstrap.js"></script>
		<script type="text/javascript" src="__RESOURCE__/script/angular.min.js"></script>
		<link type="text/css" rel="stylesheet" href="__RESOURCE__/recouse/css/font-awesome.min.css" />
		<link type="text/css" rel="stylesheet" href="__RESOURCE__/mobile/style/common.mobile.css">
		<link type="text/css" rel="stylesheet" href="__RESOURCE__/mobile/style/style.css">
		<link href="__RESOURCE__/recouse/css/bjcommon.css" rel="stylesheet" type="text/css" /> 
		<link rel="shortcut icon" href="favicon.ico"/>
		<link rel="stylesheet" type="text/css" href="__RESOURCE__/recouse/js/webuploader/webuploader.css"/>
		<script type="text/javascript" src="__RESOURCE__/script/cascade.js"></script>
		<script type="text/javascript" src="__RESOURCE__/mobile/script/jquery.touchwipe.js"></script>
		<script src="__RESOURCE__/recouse/js/webuploader/webuploader.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="__RESOURCE__/mobile/script/swipe.js"></script>
	</head>
	<style>
		.box{
			width: 1190px;
			+width: 1188px;
			height:400px;
			margin-top: 40px;
			margin-bottom: 30px;
			border: solid 1px gainsboro;
		}
	
		.box .top{
			width: 1188px;
			+width: 1148px;
			height: 50px;
			+height: 30px;
			padding: 10px 20px;
			vertical-align: middle;
			background: rgb(236,255,220);
		}
		.box .top img{
			width: 30px;
			height: auto;
		}
	   	.box .top span{
	   		display: inline-block;
	   		height: 20px;
	   		font-size: 16px;
	   		margin-top: 5px;
	   		color: black;
	   		margin-left: 10px;
	   	}
	   	.box .content{
	   		width: 90%;
	   		overflow: hidden;
	   		margin-left: 5%;
	   		margin-top: 70px;
	   		color: black;
	   		font-size: 16px;
	   	}
	   	.box .content p{
	   		margin-top: 10px;
	   	}
	   	.Btn{
	   		color: #127BAB;
	   		margin-left: 10px;
	   		cursor: pointer;
	   	}
	    a:hover{text-decoration: none;}
	   	.btn:hover{color:#127BAB;}
	   	.erweima{
			 display: inline-block;margin-left:100px;font-size: 14px;text-align: center;
		}
		
		.chooseImg {
			position: absolute;
		}
		
		.indentityImg img{
			width: 200px;
			height: 120px;
		}
		.indentityImg{
			position: relative;
		}
	
		.toast{
		    width:100px;
		    display: none;
		    margin-left: 50px;
		    height: 20px;
		    background-color:gainsboro;
		    color: #fff;
		    position: fixed;
		    top: 150px;
		    z-index: 100000;
		    border-radius:2px;
		    text-align: center;
		    line-height: 20px;
		}
		.uploader-list {
			height: 120px;
			width: 200px;
			border: solid 1px gainsboro;
			position: relative;
			background: #f8f8f8;
		}
		
		.uploader-list h3 {
			transform: rotate(-25deg);
			font-size: 26px;
			font-weight: bold;
			color: #A1A1A1;
			position: absolute;
			top: 35px;
			left: 25px;
			z-index: 100;
			display: none;
		}
		
		.uploader-list .reUploader {
			margin-top: 96px;
			width: 100%;
			height: 24px;
			text-align: center;
			line-height: 24px;
			background: #000;
			opacity: 0.5;
			filter: progid:DXImageTransform.Microsoft.Alpha(opacity=70);
			color: #fff;
			margin-left: 0px;
			cursor: pointer;
			display: none;
			position: absolute;
			z-index: 100;
		}
		.guanbi{
			 float: right; 
			 cursor: pointer;
			 width: 30px;			 
			 text-align: center;
			 color: white;
			 background: #d43f3a;
			 border-radius: 3px;
			 opacity: 0.7;
		}
		.reUploader .webuploader-pick{
			height: 24px;
			line-height:15px;
			opacity: 0.7;
			filter: progid:DXImageTransform.Microsoft.Alpha(opacity=70);
			margin-left: -102px;
			margin-left: 0px\0;
			position: absolute;
			text-align: center;		
		}
	</style>
<body>	
 <!--@php  include page('header');@-->	
<div class="noidentity">
	<div class="viewport">
		<div class="box">
			<div  class="top">
				<img src="__RESOURCE__/recouse/images/success.png" />
				<span>您已成功付款</span>
			</div>
			<!--@php  if ( !empty($order) ){ @-->
			<div class="content">
				<p>
					 收货地址：
					<span><!--@php echo $order['address_province'].$order['address_city'].$order['address_area'].$order['address_address']; @--></span>
					<span style="margin-left: 10px;"><!--@php echo $order['address_realname']; @--></span>
					<span style="margin-left: 10px;"><!--@php echo $order['address_mobile']; @--></span>
				</p>	
				<p>
					 实付款：
					<span style="color: #D43F3A;">￥<!--@php echo $order['price']; @--></span>
				</p>
				<p style="font-weight: bold;">
					根据海关总署公告2016年第26号（关于跨境电子商务零售进出口商品有关监管事宜的公告），
					电子商务企业应当对购买跨境电子商务零售进出口商品的个人（订购人）身份信息进行核实，
					并向海关提供有国家主管部门认证的身份有效信息。
				</p>
				<div style="margin-top: 10px;display: <!--@php if($order['ifcustoms'] == 2){ echo 'hide';} @-->">
					<span>您需要</span>
					<span class="Btn" onclick="openDialog()">【提交清关材料】</span>
					<span class="Btn"><a href="">【稍后提供】</a></span>
				</div>
			</div>
			<!--@php } @-->
		</div>     					
	</div>
</div>

	

<div class="iDialogLayout" style="z-index: 1000000;"></div>

<!--提交清关材料页面-->

<div class="viewport" id="identity2" style="display: none;position: relative;z-index: 2000000;">
  <div class="box" style="background: white;height:600px;">
	<form class="form-horizontal" id="J_identityForm" method="post" autocomplete="off" enctype="multipart/form-data"style="border: none;">		
		<div style="padding: 10px;width: 100%;+width:1168px;background: #FFF8DB;">							
				<p style="font-weight: bold;color: black;padding-left: 30px;width: 700px;display: inline-block;+display: inline;">
					根据海关总署要求，请您配合上传收件人身份证信息，商家将使用您提交的信息办理个人物品清关手续。
				</p>	
				<span onclick="guanbi()" class="guanbi">X</span>
		</div>
		<p style="margin: 30px;margin-left: 40px;font-size: 16px;color: black;">
			请上传收件人
			<span style="color: #127BAB;"><!--@php echo $order['address_realname']; @--></span>
			的身份证信息
		</p>
		<div class="add-address img-rounded" id="addAddressPanel">						
			
			<div class="add-address-main"style="border-bottom: none;">							
				<div class="form-group">
					
					<label for="" class="col-sm-3 control-label" style="float: left;+padding-left: 0px;width: 274px;text-align: right;"> 证件照片：</label>
					<div class="col-sm-9">
						<div style="height: 190px;display: none;">

							<div style="height: 120px;width:200px;border: solid 1px gainsboro;text-align: center;float: left;">
								<input id="J_uploadFrontImage" type="file" name="front_image"style="height: 120px;width: 231px;opacity: 0;filter:Alpha(Opacity=0);cursor: pointer;">
								<span style="position: absolute;top:50px;left: 80px;cursor:pointer;"onclick="addimg()">+添加正面</span>
								示例：<br />
								<img src="__RESOURCE__/recouse/images/face.png" />
							</div>

							<div style="height: 120px;width:200px;border: solid 1px gainsboro;text-align: center;display: inline-block;float: left;margin-left: 30px;">
								<input id="J_uploadFrontImage" type="file" name="front_image"style="height: 120px;width: 231px;opacity: 0;filter:Alpha(Opacity=0);cursor:pointer">
								<span style="position: absolute;top:50px;left: 320px;cursor: pointer;"onclick="addimg()">+添加反面</span>
								示例：<br />
								<img src="__RESOURCE__/recouse/images/back.png"/>
							</div>

						</div>
						<!--web uploader在这里！！！！！！！-->
						<!--添加正面-->
						<div style="float: left;">
							<div id="fileList1" class="uploader-list">
								<div class="toast1 toast"></div>
								<div id="filePicker1" class="chooseImg">+添加正面</div>
								<span class="reUploader" id="reloaderFront">重新上传</span>
								<input type="hidden" name="identity_front_image" value="" id="front" />
								<h3>仅做清关用途</h3>
								
								<!--用于放已经上传过的图片，点击修改按钮时出现-->
								<!--@php  if(!empty($identity['identity_front_image'])) { @-->
								<div style="width: 200px;height: 120px;position: absolute;" id="oldFrontimg">
									<img src="<!--@php  echo $identity['identity_front_image'];@-->" style="width: 198px;height: 120px;" />
									<span class="reUploader" id="oldrefront" style="display: block;margin-top: -24px;">重新上传</span>
									<h3 style="display: block;">仅做清关用途</h3>
								</div>
								<!--@php  } @-->
								
							</div>
							<div style="text-align: center;margin-top: 5px;">
								示例：<br />
								<img src="__RESOURCE__/recouse/images/face.png" />
							</div>
						</div>
						<!--添加反面-->
						<div style="float: left;margin-left: 50px;">
							<div id="fileList2" class="uploader-list">
								<div class="toast2 toast"></div>
								<div id="filePicker2" class="chooseImg">+添加反面</div>
								<span class="reUploader" id="reloaderBack" ></span>
								<input type="hidden" name="identity_back_image" value="" id="back" />
								<h3>仅做清关用途</h3>
								
								<!--用于放已经上传过的图片，点击修改按钮时出现-->
								<!--@php  if(!empty($identity['identity_back_image'])) { @-->
								<div style="width: 200px;height: 120px;position: absolute;" id="oldBackimg">
									<img src="<!--@php  echo $identity['identity_back_image'];@-->" style="width: 198px;height: 120px;" />
									<span class="reUploader" id="oldreback" style="display: block;margin-top: -24px;"></span>
									<h3 style="display: block;">仅做清关用途</h3>
								</div>
								<!--@php  } @-->
								
							</div>
							<div style="text-align: center;margin-top: 5px;">
								示例：<br />
								<img src="__RESOURCE__/recouse/images/back.png" />
							</div>
						</div>

						
						<!--扫描二维码-->
						<div class="erweima">
							<img src="__RESOURCE__/recouse/images/weixin.jpg" style="width: 80px;height: 80px;"/>
							<p>上传照片太麻烦？</p>
							<p>直接扫码App端认证吧！</p>
						</div>
						<div style="clear: both;">
							
						</div>
						<div style="color:rgb(153,153,153);width: 884px;float: right;">
							注：</br>
							1、支持JPG、JPEG、GIF和PNG格式，单张图片大小不超过5M<br />
							2、需上传清晰的身份证正、反面，共两张照片
						</div>
					</div>
				</div>
				<div class="form-group">					
					<p style="margin-left: 225px;margin-bottom: 10px;">
						<img src="__RESOURCE__/recouse/images/attention.png" style="width: 20px;"/>
						觅海将严格保护您身份证信息的安全。请您务必提交真实、准确、有效的信息，以便您的商品顺利清关。
					</p>								 
		        	<input type="checkbox" id="_input" onclick="check()" style="+display: inline;+margin-top: -15px;margin-left: 225px;" onfocus="this.blur()"/>
		            <p style="margin-left:10px;display: inline-block;+display: inline;">
		            	我同意身份证信息将由商家用于商品清关。	             	
		            </p>
				</div>
				<div class="form-group">
					<div class="col-sm-12" style="text-align: center;position: relative;">
						<button type="button" class="btn btn-danger" id="Btn" onclick="saveIdentity();"style="position: absolute;left: 18.5%;">确认提交</button>						
					</div>
				</div>
				<div class="form-group"style="margin-top: 50px;">
					<p style="margin-left: 225px;">
						如果您无法提供
						<span><!--@php echo $order['address_realname']; @--></span>
						的身份证，您可以：
					</p>
					<p style="margin-left: 225px;margin-top: 10px;">
						<a style="color: #127BAB;cursor: pointer;">联系卖家</a>
						修改收货人姓名，再上传身份证
					</p>
				</div>
			</div>
		</div>
	</form>
</div>

</div>	
<!--@php include themePage('footer');@-->
</body>
<script>
	//关闭弹出		
	function guanbi(){
		$('#identity2').hide();
		$(".noidentity").show();
		$(".iDialogLayout").hide();		
	}
  	//弹出
     function openDialog(){	     
		 $('#identity2').show();
		 $(".iDialogLayout").show();
		 $(".noidentity").hide();
		 uploaderfrontImg();
		 uploaderbackImg()
	 }
//	 $(document).ready(function(){
//       $('.iDialogLayout').click(function(){
//		    var id = $("#addressval").val();
//		    $(".noidentity").show();
//		    $('.iDialogLayout').hide();
//		    $.post('<!--@php  echo mobile_url("address")@-->', {'ids' : id}, function(s) {
//			      if (s.result == 1){
//				      $("#address_default").html(s.content);
//					  $("#addressval").val(s.id);
//			      }
//          }, 'json');
//		 });
//	 });

	//上传正面		
			function uploaderfrontImg() {
				// 初始化Web Uploader
				var $ = jQuery,
					$list = $('#fileList1'),
					// 优化retina, 在retina下这个值是2
					ratio = window.devicePixelRatio || 1,

					// 缩略图大小
					thumbnailWidth = 100 * ratio,
					thumbnailHeight = 100 * ratio,

					// Web Uploader实例
					uploader;
				var uploader = WebUploader.create({

					// 选完文件后，是否自动上传。
					auto: true,

					swf: '__RESOURCE__/recouse/js/webuploader/Uploader.swf',

					// 文件接收服务端。
					server: "fileupload.php?dir=identy",

					// 选择文件的按钮。可选。
					// 内部根据当前运行是创建，可能是input元素，也可能是flash.

					pick: '#filePicker1',

					//可以重复上传
					duplicate: true,

					// 只允许选择图片文件。
					accept: {
						title: 'Images',
						extensions: 'gif,jpg,jpeg,bmp,png',
						mimeTypes: 'image/jpg,image/jpeg,image/png'
					}

				});

				uploader.addButton({
					id: '#reloaderFront',
					innerHTML: '重新上传'
				});
				uploader.addButton({
					id: '#oldrefront',
					innerHTML: '重新上传'
				});
					// 当有文件添加进来的时候
				uploader.on('fileQueued', function(file) {
					$("#fileList1 .indentityImg").remove();
					$("#fileList1 h3").hide();
					//隐藏添加照片的文字
					var $li = $(
							'<div id="' + file.id + '" class="indentityImg">' +
							'<img>' +
							'</div>'
						),
						$img = $li.find('img');
					// $list为容器jQuery实例
					$list.append($li);

					// 创建缩略图
					// 如果为非图片文件，可以不用调用此方法。
					// thumbnailWidth x thumbnailHeight 为 100 x 100
					uploader.makeThumb(file, function(error, src) {
						if(error) {
							$img.replaceWith('<span>不能预览</span>');
							return;
						}

						$img.attr('src', src);
					}, thumbnailWidth, thumbnailHeight);
				});

				// 文件上传过程中创建进度条实时显示。
				uploader.on('uploadProgress', function(file, percentage) {
					var $li = $('#' + file.id),
						$percent = $li.find('.progress span');

					// 避免重复创建
					if(!$percent.length) {
						$percent = $('<p class="progress"><span></span></p>')
							.appendTo($li)
							.find('span');
					}

					$percent.css('width', percentage * 100 + '%');
				});

				// 文件上传成功，给item添加成功class, 用样式标记上传成功。
				uploader.on('uploadSuccess', function(file,response) {
					//$("#filePicker1").hide();					
					var data = eval("(" +response._raw+ ")");
					if(data.hasOwnProperty('error')){
						toast1("long", "上传失败");
					}else{
						$("#fileList1 h3").show();
						$("#front").val(data.name);
						$('#' + file.id).addClass('upload-state-done');
					}
				});

				// 文件上传失败，显示上传出错。
				uploader.on('uploadError', function(file) {
					toast1("short", "上传失败");
				});

				// 完成上传完了，成功或者失败，先删除进度条。
				uploader.on('uploadComplete', function(file) {
					$('#' + file.id).find('.progress').remove();
					$("#reloaderFront").show();
				});

			}

			//上传背面
			function uploaderbackImg() {
				// 初始化Web Uploader
				var $ = jQuery,
					$list2 = $('#fileList2'),
					// 优化retina, 在retina下这个值是2
					ratio = window.devicePixelRatio || 1,

					// 缩略图大小
					thumbnailWidth = 100 * ratio,
					thumbnailHeight = 100 * ratio,

					// Web Uploader实例
					uploader;
				var uploader = WebUploader.create({

					// 选完文件后，是否自动上传。
					auto: true,

					// swf文件路径
					swf: '__RESOURCE__/recouse/js/webuploader/Uploader.swf',

					// 文件接收服务端。
					server: "fileupload.php?dir=identy",

					// 选择文件的按钮。可选。
					// 内部根据当前运行是创建，可能是input元素，也可能是flash.
					pick: '#filePicker2',

					//可以重复上传
					duplicate: true,

					// 只允许选择图片文件。
					accept: {
						title: 'Images',
						extensions: 'gif,jpg,jpeg,bmp,png',
						mimeTypes: 'image/jpg,image/jpeg,image/png'
					}
				});
				
				uploader.addButton({
					id: '#reloaderBack',
					innerHTML: '重新上传'
				});
				//已经有验证信息图片时，点击重新上传
				uploader.addButton({
					id: '#oldreback',
					innerHTML: '重新上传'
				});
				// 当有文件添加进来的时候
				uploader.on('fileQueued', function(file) {
					$("#fileList2 .indentityImg").remove();
					$("#fileList2 h3").hide();
					var $li2 = $(
							'<div id="' + file.id + '" class="indentityImg">' +
							'<img>' +
							'</div>'
						),
						$img = $li2.find('img');

					// $list为容器jQuery实例
					$list2.append($li2);

					// 创建缩略图
					// 如果为非图片文件，可以不用调用此方法。
					// thumbnailWidth x thumbnailHeight 为 100 x 100
					uploader.makeThumb(file, function(error, src) {
						if(error) {
							$img.replaceWith('<span>不能预览</span>');
							return;
						}

						$img.attr('src', src);
					}, thumbnailWidth, thumbnailHeight);
				});

				// 文件上传过程中创建进度条实时显示。
				uploader.on('uploadProgress', function(file, percentage) {
					var $li = $('#' + file.id),
						$percent = $li.find('.progress span');

					// 避免重复创建
					if(!$percent.length) {
						$percent = $('<p class="progress"><span></span></p>')
							.appendTo($li)
							.find('span');
					}

					$percent.css('width', percentage * 100 + '%');
				});

				// 文件上传成功，给item添加成功class, 用样式标记上传成功。
				uploader.on('uploadSuccess', function(file, response) {
					//$("#filePicker2").hide();
					var data = eval("(" +response._raw+ ")");
					if(data.hasOwnProperty('error')){
						toast2("long", "上传失败");
					}else{
						$("#fileList2 h3").show();
						$("#back").val(data.name);
						$('#' + file.id).addClass('upload-state-done');
					}
				});

				// 文件上传失败，显示上传出错。
				uploader.on('uploadError', function(file) {
					toast2("short", "上传失败");
				});

				// 完成上传完了，成功或者失败，先删除进度条。
				uploader.on('uploadComplete', function(file) {
					$('#' + file.id).find('.progress').remove();
					$("#reloaderBack").show();
				});

			}
	
	 //没有勾选checkbox就不能点击确认提交
		function check(){
	    if(document.getElementById("_input").checked){
        		document.getElementById("Btn").disabled ="";
        		document.getElementById("Btn").style.background="#d43f3a";
        		document.getElementById("Btn").style.borderColor="#d43f3a"
       	}else{       
       			document.getElementById("Btn").style.background="gainsboro";
       			document.getElementById("Btn").style.borderColor="gainsboro"
        		document.getElementById("Btn").disabled ="disable";
        	 }
		}
		//点击确认提交按钮
		function saveIdentity() {
			var identity_front_image = $("#front").val();
			var identity_back_image = $("#back").val();
			if(identity_front_image == ''){
				alert('请上传身份证！');
				return false;
			}
			if(identity_back_image == ''){
				alert('请上传身份证！');
				return false;
			}
			if(!document.getElementById("_input").checked){
				alert('请先同意身份证先关说明！');
				return false;
			}
			var url = "<!--@php echo mobile_url('identity',array('op'=>'uploadIdenty','id'=>$order['identity_id'])) @-->";
			$.post(
					url,
					{'identity_front_image':identity_front_image,'identity_back_image':identity_back_image},
					function(data){
						if(data.errno == 200) {
							$('#identity2').hide();
							$(".noidentity").show();
							$(".iDialogLayout").hide();
						}else{
							alert(data.message);
						}
					},
					'json'
			);
		}
		function addimg(){
			return $("#J_uploadFrontImage").click()
		}				
		
		//显示上传正面失败
		function toast1(type,str){
			var time = 0;
			if(type == "short"){
				time = 500;
			}else if(type == "long"){
				time = 1500;
			}
			$(".toast1").show();
			$(".toast1").html(str);
			setTimeout(function(){
				$(".toast1").hide();
			},time);
		}
		
		//显示上传背面失败
		function toast2(type,str){
			var time = 0;
			if(type == "short"){
				time = 500;
			}else if(type == "long"){
				time = 1500;
			}
			$(".toast2").show();
			$(".toast2").html(str);
			setTimeout(function(){
				$(".toast2").hide();
			},time);
		}

		
</script>

</html>
