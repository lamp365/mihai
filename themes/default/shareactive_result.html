<!DOCTYPE html>
<html>
<head>
	<title>记录查询</title>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="format-detection" content="telephone=no">
	<link type="text/css" href="__RESOURCE__/recouse/bootstrap3/css/bootstrap.min.css" rel="stylesheet" />
	<link href="__RESOURCE__/recouse/css/bjcommon.css" rel="stylesheet"	type="text/css" />
	<link href="__RESOURCE__/recouse/css/bjdetail.css" rel="stylesheet"	type="text/css" />
	<link type="text/css" rel="stylesheet" href="<?php echo RESOURCE_ROOT;?>addons/common/beAlert/css/BeAlert.css" />
	<link rel="stylesheet" type="text/css" href="__RESOURCE__/recouse/css/shareactive.css"/>
	<script type="text/javascript"	src="__RESOURCE__/recouse/js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="__RESOURCE__/recouse/bootstrap3/js/bootstrap.min.js"></script>
	<script type="text/javascript"	src="__RESOURCE__/recouse/js/jquery.lazyload.min.js"></script>
	<script type="text/javascript" src="<?php echo RESOURCE_ROOT;?>addons/common/beAlert/js/beAlert.js"></script>
</head>
<body >
<!--@php  include page('header');@-->
	<div class="result-wrap">
		<!--@php if(!empty($drawRecorder)){  foreach($drawRecorder as $drawtime => $draw_arr){  @-->
		<div class="one_result">
			<!--@php if(time() > $drawtime){ @-->
				<!--@php if($draw_arr[0]['state'] == 2){  @-->
				<div class="result-phase tobedraw">正在颁奖 进行中...</div>
				<!--@php }else{ @-->
				<div class="result-phase"><!--@php echo date("Y-m-d H:i",$drawtime);@--> 已揭晓</div>
				<!--@php } @-->
			<!--@php }else{ @-->
				<!--@php if($draw_arr[0]['state'] == 3){  @-->
				<div class="result-phase"><!--@php echo date("Y-m-d H:i",$drawtime);@--> 已揭晓</div>
				<!--@php }else{ @-->
				<div class="result-phase tobedraw" id="result-phase"><!--@php echo date("Y-m-d H:i",$drawtime);@--> 进行中...</div>
				<!--@php } @-->
			<!--@php } @-->

			<ul class="clearfix">
				<!--@php foreach($draw_arr as $draw){  @-->
				<li>
					<div class="result-list-left">
						<img data-chushu="<!--@php echo $draw['stext'];@-->" data-beichushu="<!--@php echo $draw['dicount'];@-->" onclick="resultShow(this,<!--@php echo $draw['id'];@-->)" src="<!--@php echo download_pic($draw['logo'],150,150,2);@-->">
					</div>
					<div class="result-list-right">
						<div class="detail"><!--@php echo $draw['title'];@--></div>
						<div class="number">总参与人次:<!--@php echo $draw['dicount'];@--></div>

						<!--@php if(time() > $drawtime){ @-->
							<!--@php if($draw_arr[0]['state'] == 2){  @-->
								<div class="result-detail">正在颁奖</div>
							<!--@php }else{ @-->
								<div class="user-detail">
									<span>心愿幸运码:<span class="xinyuannum" style="color: #f60"><!--@php echo $draw['sn'];@--></span></span>
									<span><img onclick="youResultShow(this,<!--@php echo $draw['id'];@-->)" style="cursor: pointer;width: 16px;margin-top: 2px;" src="__RESOURCE__/recouse/images/love-yes.png">×<!--@php echo getRecorderCount($openid,$draw['id']); @--></span>
								</div>
							<!--@php } @-->
						<!--@php }else{ @-->
							<!--@php if($draw_arr[0]['state'] == 3){  @-->
							<div class="user-detail">
								<span>心愿幸运码:<span class="xinyuannum" style="color: #f60"><!--@php echo $draw['sn'];@--></span></span>
								<span><img onclick="youResultShow(this,<!--@php echo $draw['id'];@-->)" style="cursor: pointer;width: 16px;margin-top: 2px;" src="__RESOURCE__/recouse/images/love-yes.png">×<!--@php echo getRecorderCount($openid,$draw['id']); @--></span>
							</div>
							<!--@php }else{ @-->
							<div class="result-djs">
								<span>倒计时</span>
								<span class="limit_d">00</span><span class="limit_d_span">:</span><span class="limit_h">00</span>:<span class="limit_m">00</span>:<span class="limit_s">00</span>
							</div>
							<script>
								$(function(){
									countDown(<!--@php echo $drawtime;@-->,".result-djs");
								})
							</script>
							<!--@php } @-->
						<!--@php } @-->

					</div>
				</li>
				<!--@php } @-->
			</ul>
		</div>
		<!--@php }} @-->
		<!--@php echo $pager; @-->
	</div>

	<div class="modal fade result-modal" tabindex="-1" role="dialog">
	  	<div class="modal-dialog" role="document">
	    	<div class="modal-content">
	     		<div class="modal-header">
	        		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        		<h4 class="modal-title">获得者参与记录</h4>
		      	</div>
		      	<div class="modal-body">
		      	</div>
		      	<div class="modal-footer">
		        	<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">关闭</button>
		      	</div>
		    </div>
	  	</div>
	</div>
	<div class="modal fade you-result-modal" tabindex="-1" role="dialog">
	  	<div class="modal-dialog" role="document">
	    	<div class="modal-content">
	     		<div class="modal-header">
	        		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        		<h4 class="modal-title">您的参与记录</h4>
		      	</div>
		      	<div class="modal-body">
		      		<div class="result-num">你的心愿码:<span class="the-number">10086868 10086870 10086867 10086866</span></div>
		      	</div>
		      	<div class="modal-footer">
		        	<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
		      	</div>
		    </div>
	  	</div>
	</div>
<!--@php include themePage('footer');@-->
<script type="text/javascript">
	function resultShow(thisObj,award_id){
		var result_obj = $(thisObj).closest('.one_result').find('.result-phase');
		if($(result_obj).hasClass("tobedraw")){
			//如果是待开奖的  点击无反应
			alert("请等待开奖处理完毕！");
			return '';
		}
		$(".result-modal .modal-body").html("");

		var xinyuannum = $(thisObj).parent(".result-list-left").siblings(".result-list-right").find(".xinyuannum").text();
		var chusu    = $(thisObj).data('chushu');
		var beichusu = $(thisObj).data('beichushu');
		var yushu = chusu%beichusu+1;
		var html = '';

		html = "<div>心愿幸运码:<span class='xinyuannum' style='color: #f60;margin-left:10px;'>"+xinyuannum+"</span></div>"+
      		"<div>"+
      			"<ul class='result-rule clearfix'>"+
      				"<li style='line-height: 40px;'>计算公式 = </li>"+
      				"<li>(</li>"+
      				"<li>"+
      					"<p>"+chusu+"</p>"+
      					"<span>标准数据</span>"+
      				"</li>"+
      				"<li>"+
      					"<p>%</p>"+
      					"<span>求余</span>"+
      				"</li>"+
      				"<li><p>"+beichusu+"</p><span>参与人次</span></li>"+
      				"<li>)</li>"+
      				"<li>+</li>"+
      				"<li>"+
      					"<p>1</p>"+
      					"<span>固定值</span>"+
      				"</li>"+
      				"<li><p>= "+yushu+"</p><span>号数</span></li>"+
      			"</ul>"+
      			"<ul class='result-rule clearfix' style='margin-top: 10px'>"+
				"<li style='line-height: 36px;'>p"+award_id+"00000"+ yushu +" = </li>"+
      				"<li>"+
      					"<p>p+</p>"+
      					"<span>固定</span>"+
      				"</li>"+
      				"<li>"+
						"<p>"+award_id+"</p>"+
      					"<span>礼品id</span>"+
      				"</li>"+
      				"<li>+</li>"+
      				"<li><p>00000</p><span>固定值</span></li>"+
      				"<li>+</li>"+
      				"<li><p>"+yushu+"</p><span>号数</span></li>"+
      			"</ul>"+
      		"</div>";
		$(".result-modal").modal();
		$(".result-modal .modal-body").html(html);

	}
	function youResultShow(thisObj,award_id){
		var url = "<!--@php echo mobile_url('shareactive',array('op'=>'canyu_recorder'));@-->";
		$.post(url,{'award_id':award_id},function(data){
			if( data.errno != 200 ){
				$(".you-result-modal .modal-body").html("<p>"+data.message+"<p>");
			}else{
				var html = "<div class='result-num'><span>您的心愿码:</span>";
				var recorder = data.message;
				for(var i = 0;i < recorder.length;i++){
					var item    = recorder[i];
					html = html + "<span>"+item.star_num + "</span>";
				}
				html = html + "</div>";
				$(".you-result-modal .modal-body").html(html);
			}
			$(".you-result-modal").modal();
		},"json");
	}
	//预告的倒计时
	function countDown(time,id){
        var end_time = time * 1000,//月份是实际月份-1
        sys_second = (end_time-new Date().getTime())/1000;
        getTime(sys_second,id);
        var timer = setInterval(function(){
            if (sys_second > 1) {
                sys_second -= 1;
                getTime(sys_second,id);
            } else {
                clearInterval(timer);	                   
            }
        }, 1000);
        
    }
    function getTime(sys_second,id){
        var day = Math.floor((sys_second / 3600) / 24);
        var hour = Math.floor((sys_second / 3600) % 24);
        var minute = Math.floor((sys_second / 60) % 60);
        var second = Math.floor(sys_second % 60);
        if($(id+' .limit_d')){
           if( day <=0 ){
        		$(id+' .limit_d').hide();
        		$(id+' .limit_d_span').hide();
        	}else{
        		$(id+' .limit_d').text(day<10?"0"+day:day);
        	}
        }
        if( day<=0 && hour<=0 && second <=0 && minute<=0 ){
            $(id).html("正在颁奖");
            //window.location.reload();
        }
        $(id+' .limit_h').text(hour<10?"0"+hour:hour);    //计算小时
        $(id+' .limit_m').text(minute<10?"0"+minute:minute); //计算分钟
        $(id+' .limit_s').text(second<10?"0"+second:second); //计算秒
    }
</script>
</body>
</html>
